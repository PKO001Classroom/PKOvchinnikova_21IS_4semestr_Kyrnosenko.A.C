# –í—Ç–æ—Ä–æ–π —Ñ–∞–π–ª - –ê–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏–π –∂—É—Ä–Ω–∞–ª –∑–Ω–∞–Ω–∏–π

```python
# database
## –ó–¥–µ—Å—å —Å–æ–¥–µ—Ä–∂–∞—Ç—Å—è –¥–∞–Ω–Ω—ã–µ –ø—Ä–æ–≥—Ä–∞–º–º—ã
import psycopg2
from psycopg2 import Error
import os
from datetime import datetime
from pathlib import Path


class Database:
    def __init__(self):
        self.connection = None
        self.cursor = None
        self.connect()

    def connect(self):
        """–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö PostgreSQL"""
        try:
            self.connection = psycopg2.connect(
                host="localhost",
                database="knowledge_journal",
                user="postgres",  # –∑–∞–º–µ–Ω–∏—Ç–µ –Ω–∞ –≤–∞—à–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                password="1111",  # –∑–∞–º–µ–Ω–∏—Ç–µ –Ω–∞ –≤–∞—à –ø–∞—Ä–æ–ª—å
                port="5432"
            )
            self.cursor = self.connection.cursor()
            print("‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ PostgreSQL —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ")
            return True
        except Error as e:
            print(f"‚ùå –û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ PostgreSQL: {e}")
            return False

    def initialize_database(self):
        """–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö (—Å–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü –µ—Å–ª–∏ –∏—Ö –Ω–µ—Ç)"""
        try:
            # –°–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã notes
            self.cursor.execute("""
                CREATE TABLE IF NOT EXISTS notes (
                    id SERIAL PRIMARY KEY,
                    title VARCHAR(255) NOT NULL,
                    file_path VARCHAR(500) UNIQUE NOT NULL,
                    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
                    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
                    category VARCHAR(100)
                )
            """)

            # –°–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã tags
            self.cursor.execute("""
                CREATE TABLE IF NOT EXISTS tags (
                    id SERIAL PRIMARY KEY,
                    name VARCHAR(100) UNIQUE NOT NULL
                )
            """)

            # –°–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã note_tags
            self.cursor.execute("""
                CREATE TABLE IF NOT EXISTS note_tags (
                    note_id INT REFERENCES notes(id) ON DELETE CASCADE,
                    tag_id INT REFERENCES tags(id) ON DELETE CASCADE,
                    PRIMARY KEY (note_id, tag_id)
                )
            """)

            # –°–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã activity_log
            self.cursor.execute("""
                CREATE TABLE IF NOT EXISTS activity_log (
                    id SERIAL PRIMARY KEY,
                    note_id INT REFERENCES notes(id) ON DELETE CASCADE,
                    event_type VARCHAR(20) CHECK (event_type IN ('CREATE', 'UPDATE', 'VIEW')),
                    event_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP
                )
            """)

            self.connection.commit()
            print("‚úÖ –¢–∞–±–ª–∏—Ü—ã –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω—ã")
            return True

        except Error as e:
            print(f"‚ùå –û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –ë–î: {e}")
            return False

    def close(self):
        """–ó–∞–∫—Ä—ã—Ç–∏–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å –ë–î"""
        if self.cursor:
            self.cursor.close()
        if self.connection:
            self.connection.close()
            print("üîå –°–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —Å –ë–î –∑–∞–∫—Ä—ã—Ç–æ")


if __name__ == "__main__":
    # –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
    db = Database()
    if db.connection:
        print("‚úÖ –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –¥–æ—Å—Ç—É–ø–Ω–∞")
        db.initialize_database()
        db.close()
    else:
        print("‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ –ë–î")

---
# –†–∞–±–æ—Ç–∞ —Å Markdown —Ñ–∞–π–ª–∞–º–∏
## file_manager
import psycopg2
from psycopg2 import Error
import os
from datetime import datetime
from pathlib import Path


class Database:
    def __init__(self):
        self.connection = None
        self.cursor = None
        self.connect()

    def connect(self):
        """–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö PostgreSQL"""
        try:
            self.connection = psycopg2.connect(
                host="localhost",
                database="knowledge_journal",
                user="postgres",  # –∑–∞–º–µ–Ω–∏—Ç–µ –Ω–∞ –≤–∞—à–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                password="1111",  # –∑–∞–º–µ–Ω–∏—Ç–µ –Ω–∞ –≤–∞—à –ø–∞—Ä–æ–ª—å
                port="5432"
            )
            self.cursor = self.connection.cursor()
            print("‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ PostgreSQL —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ")
            return True
        except Error as e:
            print(f"‚ùå –û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ PostgreSQL: {e}")
            return False

    def initialize_database(self):
        """–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö (—Å–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü –µ—Å–ª–∏ –∏—Ö –Ω–µ—Ç)"""
        try:
            # –°–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã notes
            self.cursor.execute("""
                CREATE TABLE IF NOT EXISTS notes (
                    id SERIAL PRIMARY KEY,
                    title VARCHAR(255) NOT NULL,
                    file_path VARCHAR(500) UNIQUE NOT NULL,
                    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
                    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
                    category VARCHAR(100)
                )
            """)

            # –°–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã tags
            self.cursor.execute("""
                CREATE TABLE IF NOT EXISTS tags (
                    id SERIAL PRIMARY KEY,
                    name VARCHAR(100) UNIQUE NOT NULL
                )
            """)

            # –°–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã note_tags
            self.cursor.execute("""
                CREATE TABLE IF NOT EXISTS note_tags (
                    note_id INT REFERENCES notes(id) ON DELETE CASCADE,
                    tag_id INT REFERENCES tags(id) ON DELETE CASCADE,
                    PRIMARY KEY (note_id, tag_id)
                )
            """)

            # –°–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã activity_log
            self.cursor.execute("""
                CREATE TABLE IF NOT EXISTS activity_log (
                    id SERIAL PRIMARY KEY,
                    note_id INT REFERENCES notes(id) ON DELETE CASCADE,
                    event_type VARCHAR(20) CHECK (event_type IN ('CREATE', 'UPDATE', 'VIEW')),
                    event_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP
                )
            """)

            self.connection.commit()
            print("‚úÖ –¢–∞–±–ª–∏—Ü—ã –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω—ã")
            return True

        except Error as e:
            print(f"‚ùå –û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –ë–î: {e}")
            return False

    def close(self):
        """–ó–∞–∫—Ä—ã—Ç–∏–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å –ë–î"""
        if self.cursor:
            self.cursor.close()
        if self.connection:
            self.connection.close()
            print("üîå –°–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —Å –ë–î –∑–∞–∫—Ä—ã—Ç–æ")


if __name__ == "__main__":
    # –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
    db = Database()
    if db.connection:
        print("‚úÖ –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –¥–æ—Å—Ç—É–ø–Ω–∞")
        db.initialize_database()
        db.close()
    else:
        print("‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ –ë–î")

---
# gui
## –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å Tkinter
import tkinter as tk
from tkinter import ttk, scrolledtext


class KnowledgeJournalApp:
    def __init__(self):
        self.root = tk.Tk()
        self.root.title("–ê–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏–π –∂—É—Ä–Ω–∞–ª –∑–Ω–∞–Ω–∏–π")
        self.root.geometry("1200x800")

        # 1. –ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è (Frame)
        self.create_control_panel()

        # 2. –°–ø–∏—Å–æ–∫ –∫–æ–Ω—Å–ø–µ–∫—Ç–æ–≤ (Treeview)
        self.create_notes_list()

        # 3. –û–±–ª–∞—Å—Ç—å —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è (ScrolledText)
        self.create_editor_panel()

        # 4. –ü–∞–Ω–µ–ª—å —Ç–µ–≥–æ–≤ (Frame —Å Label –∏ Entry)
        self.create_tags_panel()

        # 5. –í–∫–ª–∞–¥–∫–∞ –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ (Notebook)
        self.create_analytics_tab()

---

# analytics
## –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –∏ —Å–±–æ—Ä —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
class Analytics:
    def get_category_stats(self):
        """–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–æ–Ω—Å–ø–µ–∫—Ç–æ–≤ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º"""
        query = """
        SELECT category, COUNT(*) as count 
        FROM notes 
        GROUP BY category 
        ORDER BY count DESC
        """

    def get_recent_activity(self, days=7):
        """–ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ N –¥–Ω–µ–π"""
        query = """
        SELECT DATE(event_time) as date, 
               COUNT(*) as activities
        FROM activity_log 
        WHERE event_time >= CURRENT_DATE - INTERVAL '%s days'
        GROUP BY DATE(event_time)
        ORDER BY date
        """

    def get_top_tags(self, limit=5):
        """–°–∞–º—ã–µ –ø–æ–ø—É–ª—è—Ä–Ω—ã–µ —Ç–µ–≥–∏"""
        query = """
        SELECT t.name, COUNT(nt.note_id) as usage_count
        FROM tags t
        JOIN note_tags nt ON t.id = nt.tag_id
        GROUP BY t.id
        ORDER BY usage_count DESC
        LIMIT %s
        """

---
# excel_exporter
## –≠–∫—Å–ø–æ—Ä—Ç –≤ Excel
from openpyxl import Workbook
from openpyxl.chart import BarChart, Reference
import os


class ExcelExporter:
    def export_report(self, data, filename="exports/report.xlsx"):
        """–°–æ–∑–¥–∞–Ω–∏–µ Excel —Ñ–∞–π–ª–∞ —Å –¥–≤—É–º—è –ª–∏—Å—Ç–∞–º–∏"""

        # 1. –°–æ–∑–¥–∞—ë–º —Ä–∞–±–æ—á—É—é –∫–Ω–∏–≥—É
        wb = Workbook()

        # 2. –õ–∏—Å—Ç "–î–∞–Ω–Ω—ã–µ" - —Ç–∞–±–ª–∏—Ü–∞ —Å–æ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–æ–π
        ws_data = wb.active
        ws_data.title = "–î–∞–Ω–Ω—ã–µ"

        # 3. –î–æ–±–∞–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ
        for row in data['category_stats']:
            ws_data.append([row['category'], row['count']])

        # 4. –õ–∏—Å—Ç "–ì—Ä–∞—Ñ–∏–∫–∏" - –¥–∏–∞–≥—Ä–∞–º–º—ã
        ws_chart = wb.create_sheet("–ì—Ä–∞—Ñ–∏–∫–∏")

        # 5. –°–æ–∑–¥–∞—ë–º —Å—Ç–æ–ª–±—á–∞—Ç—É—é –¥–∏–∞–≥—Ä–∞–º–º—É
        chart = BarChart()
        chart.title = "–ö–æ–Ω—Å–ø–µ–∫—Ç—ã –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º"
        chart.x_axis.title = "–ö–∞—Ç–µ–≥–æ—Ä–∏–∏"
        chart.y_axis.title = "–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ"

        # 6. –î–æ–±–∞–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –≤ –¥–∏–∞–≥—Ä–∞–º–º—É
        data_ref = Reference(ws_data, min_col=2, min_row=1, max_row=len(data['category_stats']))
        cats_ref = Reference(ws_data, min_col=1, min_row=2, max_row=len(data['category_stats']))

        chart.add_data(data_ref, titles_from_data=True)
        chart.set_categories(cats_ref)

        # 7. –î–æ–±–∞–≤–ª—è–µ–º –¥–∏–∞–≥—Ä–∞–º–º—É –Ω–∞ –ª–∏—Å—Ç
        ws_chart.add_chart(chart, "A1")

        # 8. –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ñ–∞–π–ª
        os.makedirs("exports", exist_ok=True)
        wb.save(filename)

---
# pdf_exporter
## –ì–µ–Ω–µ—Ä–∞—Ü–∏—è PDF –æ—Ç—á—ë—Ç–æ–≤
from reportlab.lib.pagesizes import A4
from reportlab.platypus import SimpleDocTemplate, Table, TableStyle, Paragraph, Image
from reportlab.lib.styles import getSampleStyleSheet
from reportlab.lib import colors
import matplotlib.pyplot as plt


class PDFExporter:
    def export_pdf(self, data, filename="exports/report.pdf"):
        """–ì–µ–Ω–µ—Ä–∞—Ü–∏—è PDF –æ—Ç—á—ë—Ç–∞"""

        # 1. –°–æ–∑–¥–∞—ë–º PDF –¥–æ–∫—É–º–µ–Ω—Ç
        doc = SimpleDocTemplate(filename, pagesize=A4)
        story = []

        # 2. –ó–∞–≥–æ–ª–æ–≤–æ–∫
        styles = getSampleStyleSheet()
        title = Paragraph("–ê–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏–π –æ—Ç—á—ë—Ç –ø–æ –∫–æ–Ω—Å–ø–µ–∫—Ç–∞–º", styles['Title'])
        story.append(title)

        # 3. –¢–∞–±–ª–∏—Ü–∞ —Å –º–µ—Ç—Ä–∏–∫–∞–º–∏
        metrics_data = [
            ["–ú–µ—Ç—Ä–∏–∫–∞", "–ó–Ω–∞—á–µ–Ω–∏–µ"],
            ["–í—Å–µ–≥–æ –∫–æ–Ω—Å–ø–µ–∫—Ç–æ–≤", data['total_notes']],
            ["–ö–∞—Ç–µ–≥–æ—Ä–∏–π", len(data['category_stats'])],
            ["–¢–µ–≥–æ–≤", data['total_tags']],
            ["–ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –∑–∞ 7 –¥–Ω–µ–π", data['activity_7_days']]
        ]

        table = Table(metrics_data)
        table.setStyle(TableStyle([
            ('BACKGROUND', (0, 0), (-1, 0), colors.grey),
            ('TEXTCOLOR', (0, 0), (-1, 0), colors.whitesmoke),
            ('ALIGN', (0, 0), (-1, -1), 'CENTER'),
            ('GRID', (0, 0), (-1, -1), 1, colors.black)
        ]))
        story.append(table)

        # 4. –°–æ–∑–¥–∞—ë–º –≥—Ä–∞—Ñ–∏–∫ —Å matplotlib
        fig = self.create_chart(data)
        chart_path = "exports/chart_temp.png"
        fig.savefig(chart_path)

        # 5. –î–æ–±–∞–≤–ª—è–µ–º –≥—Ä–∞—Ñ–∏–∫ –≤ PDF
        chart_img = Image(chart_path, width=400, height=300)
        story.append(chart_img)

        # 6. –°–ø–∏—Å–æ–∫ –ø–æ—Å–ª–µ–¥–Ω–∏—Ö –∫–æ–Ω—Å–ø–µ–∫—Ç–æ–≤
        recent_title = Paragraph("–ü–æ—Å–ª–µ–¥–Ω–∏–µ –∫–æ–Ω—Å–ø–µ–∫—Ç—ã:", styles['Heading2'])
        story.append(recent_title)

        # 7. –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º PDF
        doc.build(story)

---
# main
## –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞, –∑–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
import tkinter as tk
from tkinter import ttk, messagebox, scrolledtext
import os
import subprocess
import platform
from datetime import datetime
from pathlib import Path


class KnowledgeJournalApp:
    def __init__(self):
        self.root = tk.Tk()
        self.root.title("–ê–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏–π –∂—É—Ä–Ω–∞–ª –∑–Ω–∞–Ω–∏–π")
        self.root.geometry("1200x800")

        # –ü–æ–ª—É—á–∞–µ–º –∞–±—Å–æ–ª—é—Ç–Ω—ã–µ –ø—É—Ç–∏ –∫ –Ω—É–∂–Ω—ã–º –ø–∞–ø–∫–∞–º
        self.base_dir = Path(__file__).parent  # –ü–∞–ø–∫–∞ –≥–¥–µ –ª–µ–∂–∏—Ç main.py
        self.project_root = self.base_dir.parent  # –ü–∞–ø–∫–∞ "PythonProject15" –∏–ª–∏ –¥—Ä—É–≥–∞—è

        # –ü–∞–ø–∫–∏ –¥–ª—è —Ñ–∞–π–ª–æ–≤ –ø—Ä–æ–µ–∫—Ç–∞
        self.notes_dir = self.project_root / "notes_md"
        self.exports_dir = self.project_root / "exports"

        # –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–æ, –º–æ–∂–Ω–æ —É–∫–∞–∑–∞—Ç—å –∞–±—Å–æ–ª—é—Ç–Ω—ã–π –ø—É—Ç—å (–¥–ª—è –≤–∞—à–µ–≥–æ —Å–ª—É—á–∞—è)
        self.exports_dir = Path(r"C:\Users\Student\Desktop\21Is\–ü—Ä–æ–µ–∫—Ç2,1\exports")
        self.notes_dir = Path(r"C:\Users\Student\Desktop\21Is\–ü—Ä–æ–µ–∫—Ç2,1\notes_md")

        print(f"üìÅ –ü–∞–ø–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞: {self.project_root}")
        print(f"üìÅ –ü–∞–ø–∫–∞ —Å –∑–∞–º–µ—Ç–∫–∞–º–∏: {self.notes_dir}")
        print(f"üìÅ –ü–∞–ø–∫–∞ –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞: {self.exports_dir}")

        # –°–æ–∑–¥–∞–µ–º –ø–∞–ø–∫–∏ –µ—Å–ª–∏ –∏—Ö –Ω–µ—Ç
        self.notes_dir.mkdir(exist_ok=True)
        self.exports_dir.mkdir(exist_ok=True)

        # –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –ø–∞–ø–æ–∫
        self.check_folders()

        # –¢–µ–∫—É—â–∏–π –≤—ã–±—Ä–∞–Ω–Ω—ã–π –∫–æ–Ω—Å–ø–µ–∫—Ç
        self.current_note = None
        self.current_note_id = None
        self.current_file_path = None

        # –°–æ–∑–¥–∞–µ–º –≤—Å–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
        self.create_control_panel()
        self.create_notes_list()
        self.create_editor_panel()
        self.create_tags_panel()
        self.create_analytics_tab()

        # –ó–∞–≥—Ä—É–∂–∞–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Ñ–∞–π–ª—ã
        self.load_existing_notes()

    def check_folders(self):
        """–ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –ø–∞–ø–æ–∫"""
        if not self.notes_dir.exists():
            print(f"‚ö†Ô∏è –ü–∞–ø–∫–∞ notes_md –Ω–µ –Ω–∞–π–¥–µ–Ω–∞, —Å–æ–∑–¥–∞–µ–º...")
        if not self.exports_dir.exists():
            print(f"‚ö†Ô∏è –ü–∞–ø–∫–∞ exports –Ω–µ –Ω–∞–π–¥–µ–Ω–∞, —Å–æ–∑–¥–∞–µ–º...")

        print(f"‚úÖ –ü–∞–ø–∫–∏ –ø—Ä–æ–≤–µ—Ä–µ–Ω—ã:")
        print(f"   notes_md: {self.notes_dir} (—Å—É—â–µ—Å—Ç–≤—É–µ—Ç: {self.notes_dir.exists()})")
        print(f"   exports: {self.exports_dir} (—Å—É—â–µ—Å—Ç–≤—É–µ—Ç: {self.exports_dir.exists()})")

    def create_control_panel(self):
        """–ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å –ø–æ–ª—è–º–∏ –≤–≤–æ–¥–∞ –∏ –∫–Ω–æ–ø–∫–∞–º–∏"""
        control_frame = ttk.LabelFrame(self.root, text="–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Å–ø–µ–∫—Ç–∞–º–∏", padding=10)
        control_frame.pack(fill="x", padx=10, pady=5)

        # –ü–æ–ª–µ –¥–ª—è –Ω–∞–∑–≤–∞–Ω–∏—è
        ttk.Label(control_frame, text="–ù–∞–∑–≤–∞–Ω–∏–µ:").grid(row=0, column=0, sticky="w", padx=5, pady=5)
        self.title_entry = ttk.Entry(control_frame, width=40)
        self.title_entry.grid(row=0, column=1, padx=5, pady=5)

        # –ü–æ–ª–µ –¥–ª—è –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
        ttk.Label(control_frame, text="–ö–∞—Ç–µ–≥–æ—Ä–∏—è:").grid(row=0, column=2, sticky="w", padx=5, pady=5)
        self.category_entry = ttk.Entry(control_frame, width=20)
        self.category_entry.grid(row=0, column=3, padx=5, pady=5)

        # –ö–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
        buttons_frame = ttk.Frame(control_frame)
        buttons_frame.grid(row=1, column=0, columnspan=4, pady=10)

        ttk.Button(buttons_frame, text="–°–æ–∑–¥–∞—Ç—å", command=self.create_note).pack(side="left", padx=5)
        ttk.Button(buttons_frame, text="–°–æ—Ö—Ä–∞–Ω–∏—Ç—å", command=self.save_note).pack(side="left", padx=5)
        ttk.Button(buttons_frame, text="–£–¥–∞–ª–∏—Ç—å", command=self.delete_note).pack(side="left", padx=5)
        ttk.Button(buttons_frame, text="–ü—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å", command=self.view_note).pack(side="left", padx=5)
        ttk.Button(buttons_frame, text="–≠–∫—Å–ø–æ—Ä—Ç –≤ Excel", command=self.export_to_excel).pack(side="left", padx=5)
        ttk.Button(buttons_frame, text="–≠–∫—Å–ø–æ—Ä—Ç –≤ PDF", command=self.export_to_pdf).pack(side="left", padx=5)

        # –ö–Ω–æ–ø–∫–∞ –¥–ª—è –æ—Ç–∫—Ä—ã—Ç–∏—è –ø–∞–ø–∫–∏ exports
        ttk.Button(buttons_frame, text="üìÇ –û—Ç–∫—Ä—ã—Ç—å –ø–∞–ø–∫—É exports",
                   command=self.open_exports_folder).pack(side="left", padx=5)

    def create_notes_list(self):
        """–°–ø–∏—Å–æ–∫ –∫–æ–Ω—Å–ø–µ–∫—Ç–æ–≤ –≤ Treeview"""
        list_frame = ttk.LabelFrame(self.root, text="–ö–æ–Ω—Å–ø–µ–∫—Ç—ã", padding=10)
        list_frame.pack(fill="both", expand=True, padx=10, pady=5)

        # –°–æ–∑–¥–∞–µ–º Treeview
        columns = ("ID", "–ù–∞–∑–≤–∞–Ω–∏–µ", "–ö–∞—Ç–µ–≥–æ—Ä–∏—è", "–°–æ–∑–¥–∞–Ω", "–û–±–Ω–æ–≤–ª–µ–Ω", "–§–∞–π–ª")
        self.notes_tree = ttk.Treeview(list_frame, columns=columns, show="headings", height=15)

        # –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –∫–æ–ª–æ–Ω–∫–∏
        for col in columns:
            self.notes_tree.heading(col, text=col)
            if col == "ID":
                self.notes_tree.column(col, width=50)
            elif col == "–§–∞–π–ª":
                self.notes_tree.column(col, width=300)
            else:
                self.notes_tree.column(col, width=150)

        # –î–æ–±–∞–≤–ª—è–µ–º —Å–∫—Ä–æ–ª–ª–±–∞—Ä
        scrollbar = ttk.Scrollbar(list_frame, orient="vertical", command=self.notes_tree.yview)
        self.notes_tree.configure(yscrollcommand=scrollbar.set)

        # –£–ø–∞–∫–æ–≤—ã–≤–∞–µ–º
        self.notes_tree.pack(side="left", fill="both", expand=True)
        scrollbar.pack(side="right", fill="y")

        # –ü—Ä–∏–≤—è–∑—ã–≤–∞–µ–º –≤—ã–±–æ—Ä —ç–ª–µ–º–µ–Ω—Ç–∞
        self.notes_tree.bind("<<TreeviewSelect>>", self.on_note_select)

    def create_editor_panel(self):
        """–û–±–ª–∞—Å—Ç—å —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è Markdown"""
        editor_frame = ttk.LabelFrame(self.root, text="–†–µ–¥–∞–∫—Ç–æ—Ä Markdown", padding=10)
        editor_frame.pack(fill="both", expand=True, padx=10, pady=5)

        # –ü–æ–¥—Å–∫–∞–∑–∫–∏ –ø–æ —Å–∏–Ω—Ç–∞–∫—Å–∏—Å—É
        hint_frame = ttk.Frame(editor_frame)
        hint_frame.pack(fill="x", pady=(0, 10))

        ttk.Label(hint_frame, text="–ü–æ–¥—Å–∫–∞–∑–∫–∏:").pack(side="left", padx=5)
        hints = ["# –ó–∞–≥–æ–ª–æ–≤–æ–∫", "**–∂–∏—Ä–Ω—ã–π**", "*–∫—É—Ä—Å–∏–≤*", "`–∫–æ–¥`", "```–±–ª–æ–∫ –∫–æ–¥–∞```"]
        for hint in hints:
            ttk.Label(hint_frame, text=hint, relief="ridge", padding=2).pack(side="left", padx=5)

        # –¢–µ–∫—Å—Ç–æ–≤—ã–π —Ä–µ–¥–∞–∫itor
        self.editor = scrolledtext.ScrolledText(editor_frame, wrap=tk.WORD, height=15)
        self.editor.pack(fill="both", expand=True)

    def create_tags_panel(self):
        """–ü–∞–Ω–µ–ª—å –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ç–µ–≥–∞–º–∏"""
        tags_frame = ttk.LabelFrame(self.root, text="–¢–µ–≥–∏", padding=10)
        tags_frame.pack(fill="x", padx=10, pady=5)

        # –ü–æ–ª–µ –¥–ª—è –≤–≤–æ–¥–∞ –Ω–æ–≤–æ–≥–æ —Ç–µ–≥–∞
        input_frame = ttk.Frame(tags_frame)
        input_frame.pack(fill="x", pady=(0, 10))

        ttk.Label(input_frame, text="–ù–æ–≤—ã–π —Ç–µ–≥:").pack(side="left", padx=5)
        self.tag_entry = ttk.Entry(input_frame, width=30)
        self.tag_entry.pack(side="left", padx=5)
        ttk.Button(input_frame, text="–î–æ–±–∞–≤–∏—Ç—å —Ç–µ–≥", command=self.add_tag).pack(side="left", padx=5)

        # –û–±–ª–∞—Å—Ç—å –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ç–µ–∫—É—â–∏—Ö —Ç–µ–≥–æ–≤
        self.tags_label = ttk.Label(tags_frame, text="–¢–µ–≥–∏ –Ω–µ –≤—ã–±—Ä–∞–Ω—ã", relief="sunken", padding=5,
                                    wraplength=1000, justify="left")
        self.tags_label.pack(fill="x")

    def create_analytics_tab(self):
        """–í–∫–ª–∞–¥–∫–∞ –∞–Ω–∞–ª–∏—Ç–∏–∫–∏"""
        analytics_frame = ttk.LabelFrame(self.root, text="–ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –∏ –æ—Ç—á—ë—Ç—ã", padding=10)
        analytics_frame.pack(fill="x", padx=10, pady=5)

        # Frame –¥–ª—è –∫–Ω–æ–ø–æ–∫ –æ—Ç—á—ë—Ç–æ–≤
        report_buttons_frame = ttk.Frame(analytics_frame)
        report_buttons_frame.pack(fill="x", pady=5)

        ttk.Button(report_buttons_frame, text="üìä –°—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å –æ—Ç—á—ë—Ç",
                   command=self.generate_report, width=20).pack(side="left", padx=5)

        ttk.Button(report_buttons_frame, text="üìà –°–æ–∑–¥–∞—Ç—å Excel —Å –≥—Ä–∞—Ñ–∏–∫–∞–º–∏",
                   command=self.create_excel_with_charts, width=25).pack(side="left", padx=5)

        ttk.Button(report_buttons_frame, text="üìÑ –°–æ–∑–¥–∞—Ç—å PDF –æ—Ç—á—ë—Ç",
                   command=self.create_pdf_report, width=20).pack(side="left", padx=5)

        # –û–±–ª–∞—Å—Ç—å –¥–ª—è –≤—ã–≤–æ–¥–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
        stats_frame = ttk.Frame(analytics_frame)
        stats_frame.pack(fill="x", pady=10)

        # –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –±—É–¥–µ—Ç –≤—ã–≤–æ–¥–∏—Ç—å—Å—è –∑–¥–µ—Å—å
        self.stats_text = scrolledtext.ScrolledText(stats_frame, height=8, wrap=tk.WORD)
        self.stats_text.pack(fill="both", expand=True)
        self.stats_text.insert("1.0", "–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –±—É–¥–µ—Ç –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∞ –∑–¥–µ—Å—å –ø–æ—Å–ª–µ —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è –æ—Ç—á—ë—Ç–∞.")
        self.stats_text.config(state="disabled")

    # === –û–°–ù–û–í–ù–´–ï –ú–ï–¢–û–î–´ ===

    def load_existing_notes(self):
        """–ó–∞–≥—Ä—É–∑–∫–∞ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö Markdown —Ñ–∞–π–ª–æ–≤ –∏–∑ –ø–∞–ø–∫–∏"""
        try:
            # –û—á–∏—â–∞–µ–º Treeview
            for item in self.notes_tree.get_children():
                self.notes_tree.delete(item)

            # –ü–æ–ª—É—á–∞–µ–º —Å–ø–∏—Å–æ–∫ —Ñ–∞–π–ª–æ–≤ –≤ –ø–∞–ø–∫–µ notes_md
            note_id = 1
            md_files = list(self.notes_dir.glob("*.md"))

            if not md_files:
                print("üìù –ü–∞–ø–∫–∞ notes_md –ø—É—Å—Ç–∞, —Å–æ–∑–¥–∞–π—Ç–µ –ø–µ—Ä–≤—ã–π –∫–æ–Ω—Å–ø–µ–∫—Ç")
                return

            print(f"üìö –ó–∞–≥—Ä—É–∂–∞—é {len(md_files)} –∫–æ–Ω—Å–ø–µ–∫—Ç–æ–≤...")

            for file_path in md_files:
                try:
                    # –ß–∏—Ç–∞–µ–º –ø–µ—Ä–≤—É—é —Å—Ç—Ä–æ–∫—É –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –Ω–∞–∑–≤–∞–Ω–∏—è
                    with open(file_path, 'r', encoding='utf-8') as f:
                        first_line = f.readline().strip()

                    # –ò–∑–≤–ª–µ–∫–∞–µ–º –Ω–∞–∑–≤–∞–Ω–∏–µ –∏–∑ –∑–∞–≥–æ–ª–æ–≤–∫–∞ Markdown
                    if first_line.startswith('# '):
                        title = first_line[2:].strip()
                    else:
                        title = file_path.stem

                    # –ü—ã—Ç–∞–µ–º—Å—è –∏–∑–≤–ª–µ—á—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é –∏–∑ —Ñ–∞–π–ª–∞
                    category = "–ë–µ–∑ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏"
                    tags_text = ""

                    with open(file_path, 'r', encoding='utf-8') as f:
                        content = f.read()
                        lines = content.split('\n')

                        for line in lines:
                            if line.lower().startswith("–∫–∞—Ç–µ–≥–æ—Ä–∏—è:"):
                                category = line.split(":", 1)[1].strip()
                            elif line.lower().startswith("—Ç–µ–≥–∏:"):
                                tags_text = line.split(":", 1)[1].strip()

                    # –ü–æ–ª—É—á–∞–µ–º –¥–∞—Ç—É –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ñ–∞–π–ª–∞
                    mtime = os.path.getmtime(file_path)
                    mod_date = datetime.fromtimestamp(mtime).strftime("%Y-%m-%d %H:%M")

                    # –ü–æ–ª—É—á–∞–µ–º –¥–∞—Ç—É —Å–æ–∑–¥–∞–Ω–∏—è —Ñ–∞–π–ª–∞
                    ctime = os.path.getctime(file_path)
                    create_date = datetime.fromtimestamp(ctime).strftime("%Y-%m-%d %H:%M")

                    # –î–æ–±–∞–≤–ª—è–µ–º –≤ Treeview
                    self.notes_tree.insert("", "end", values=(
                        note_id,
                        title,
                        category,
                        create_date,
                        mod_date,
                        str(file_path.name)
                    ))

                    note_id += 1

                except Exception as e:
                    print(f"‚ö†Ô∏è –û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Ñ–∞–π–ª–∞ {file_path}: {e}")

        except Exception as e:
            messagebox.showwarning("–í–Ω–∏–º–∞–Ω–∏–µ", f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Ñ–∞–π–ª–æ–≤: {e}")

    def on_note_select(self, event):
        """–û–±—Ä–∞–±–æ—Ç–∫–∞ –≤—ã–±–æ—Ä–∞ –∫–æ–Ω—Å–ø–µ–∫—Ç–∞ –∏–∑ —Å–ø–∏—Å–∫–∞"""
        selection = self.notes_tree.selection()
        if not selection:
            return

        item = self.notes_tree.item(selection[0])
        values = item["values"]

        if len(values) >= 5:
            self.current_note_id = values[0]
            self.current_note = values[1]

            # –ó–∞–ø–æ–ª–Ω—è–µ–º –ø–æ–ª—è
            self.title_entry.delete(0, tk.END)
            self.title_entry.insert(0, values[1])

            self.category_entry.delete(0, tk.END)
            if len(values) > 2:
                self.category_entry.insert(0, values[2])

            # –ü—ã—Ç–∞–µ–º—Å—è –∑–∞–≥—Ä—É–∑–∏—Ç—å —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ñ–∞–π–ª–∞
            try:
                # –ò—â–µ–º —Ñ–∞–π–ª –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é
                file_name = f"{values[1]}.md"
                file_path = self.notes_dir / file_name

                # –ï—Å–ª–∏ —Ñ–∞–π–ª —Å —Ç–∞–∫–∏–º –∏–º–µ–Ω–µ–º –Ω–µ –Ω–∞–π–¥–µ–Ω, –∏—â–µ–º –ø–æ –∏–º–µ–Ω–∏ –∏–∑ –∫–æ–ª–æ–Ω–∫–∏ "–§–∞–π–ª"
                if not file_path.exists() and len(values) > 5:
                    alt_file_name = values[5]
                    file_path = self.notes_dir / alt_file_name

                if file_path.exists():
                    self.current_file_path = file_path
                    with open(file_path, 'r', encoding='utf-8') as f:
                        content = f.read()

                    self.editor.delete("1.0", tk.END)
                    self.editor.insert("1.0", content)

                    # –ò–∑–≤–ª–µ–∫–∞–µ–º —Ç–µ–≥–∏ –∏–∑ —Ñ–∞–π–ª–∞
                    tags = []
                    for line in content.split('\n'):
                        if line.lower().startswith("—Ç–µ–≥–∏:"):
                            tags_line = line.split(":", 1)[1].strip()
                            tags = [tag.strip() for tag in tags_line.split(',')]
                            break

                    if tags:
                        self.tags_label.config(text=f"–¢–µ–≥–∏: {', '.join(tags)}")
                    else:
                        self.tags_label.config(text="–¢–µ–≥–∏ –Ω–µ —É–∫–∞–∑–∞–Ω—ã")

                else:
                    messagebox.showwarning("–§–∞–π–ª –Ω–µ –Ω–∞–π–¥–µ–Ω",
                                           f"–§–∞–π–ª –∫–æ–Ω—Å–ø–µ–∫—Ç–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω: {file_path}")
                    self.editor.delete("1.0", tk.END)
                    self.editor.insert("1.0", f"# {values[1]}\n\n–ö–∞—Ç–µ–≥–æ—Ä–∏—è: {values[2]}\n\n")
                    self.tags_label.config(text="–¢–µ–≥–∏ –Ω–µ –≤—ã–±—Ä–∞–Ω—ã")

            except Exception as e:
                messagebox.showerror("–û—à–∏–±–∫–∞", f"–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–∞–π–ª: {e}")

    def create_note(self):
        """–°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –∫–æ–Ω—Å–ø–µ–∫—Ç–∞"""
        title = self.title_entry.get().strip()
        category = self.category_entry.get().strip()

        if not title:
            messagebox.showwarning("–í–Ω–∏–º–∞–Ω–∏–µ", "–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –∫–æ–Ω—Å–ø–µ–∫—Ç–∞!")
            return

        # –û—á–∏—â–∞–µ–º –∏–º—è —Ñ–∞–π–ª–∞
        file_name = self.sanitize_filename(title) + ".md"
        file_path = self.notes_dir / file_name

        if file_path.exists():
            if not messagebox.askyesno("–§–∞–π–ª —Å—É—â–µ—Å—Ç–≤—É–µ—Ç",
                                       f"–§–∞–π–ª '{file_name}' —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç. –ü–µ—Ä–µ–∑–∞–ø–∏—Å–∞—Ç—å?"):
                return

        try:
            # –ü–æ–ª—É—á–∞–µ–º —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –∏–∑ —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞
            content = self.editor.get("1.0", tk.END).strip()

            # –ï—Å–ª–∏ —Ä–µ–¥–∞–∫—Ç–æ—Ä –ø—É—Å—Ç–æ–π, —Å–æ–∑–¥–∞–µ–º –±–∞–∑–æ–≤—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É
            if not content:
                content = f"""# {title}

–ö–∞—Ç–µ–≥–æ—Ä–∏—è: {category if category else "–ë–µ–∑ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏"}

–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è: {datetime.now().strftime('%Y-%m-%d %H:%M:%S')}

## –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ

## –û—Å–Ω–æ–≤–Ω—ã–µ –∏–¥–µ–∏

## –í—ã–≤–æ–¥—ã

–¢–µ–≥–∏: """
            elif not content.startswith(f"# {title}"):
                # –î–æ–±–∞–≤–ª—è–µ–º –∑–∞–≥–æ–ª–æ–≤–æ–∫ –∏ –∫–∞—Ç–µ–≥–æ—Ä–∏—é, –µ—Å–ª–∏ –∏—Ö –Ω–µ—Ç
                lines = content.split('\n')
                if not any(line.lower().startswith("–∫–∞—Ç–µ–≥–æ—Ä–∏—è:") for line in lines[:10]):
                    content = f"# {title}\n\n–ö–∞—Ç–µ–≥–æ—Ä–∏—è: {category}\n\n" + content

            # –°–æ–∑–¥–∞–µ–º —Ñ–∞–π–ª
            with open(file_path, 'w', encoding='utf-8') as f:
                f.write(content)

            # –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º ID
            new_id = len(self.notes_tree.get_children()) + 1
            current_date = datetime.now().strftime("%Y-%m-%d %H:%M")

            # –î–æ–±–∞–≤–ª—è–µ–º –≤ Treeview
            self.notes_tree.insert("", "end", values=(
                new_id,
                title,
                category if category else "–ë–µ–∑ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏",
                current_date,
                current_date,
                file_name
            ))

            # –û–±–Ω–æ–≤–ª—è–µ–º —Ç–µ–∫—É—â–∏–π –∫–æ–Ω—Å–ø–µ–∫—Ç
            self.current_note_id = new_id
            self.current_note = title
            self.current_file_path = file_path

            messagebox.showinfo("–£—Å–ø–µ—Ö", f"–ö–æ–Ω—Å–ø–µ–∫—Ç '{title}' —Å–æ–∑–¥–∞–Ω!\n\n–§–∞–π–ª: {file_path}")

        except Exception as e:
            messagebox.showerror("–û—à–∏–±–∫–∞", f"–ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ–∑–¥–∞—Ç—å –∫–æ–Ω—Å–ø–µ–∫—Ç: {e}")

    def save_note(self):
        """–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ –∫–æ–Ω—Å–ø–µ–∫—Ç–µ"""
        if not self.current_note:
            messagebox.showwarning("–í–Ω–∏–º–∞–Ω–∏–µ", "–í—ã–±–µ—Ä–∏—Ç–µ –∫–æ–Ω—Å–ø–µ–∫—Ç –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è!")
            return

        title = self.title_entry.get().strip()
        category = self.category_entry.get().strip()

        if not title:
            messagebox.showwarning("–í–Ω–∏–º–∞–Ω–∏–µ", "–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –∫–æ–Ω—Å–ø–µ–∫—Ç–∞!")
            return

        try:
            # –ü–æ–ª—É—á–∞–µ–º —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –∏–∑ —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞
            content = self.editor.get("1.0", tk.END)

            # –û–ø—Ä–µ–¥–µ–ª—è–µ–º –ø—É—Ç—å –∫ —Ñ–∞–π–ª—É
            if self.current_file_path and self.current_file_path.exists():
                file_path = self.current_file_path
            else:
                file_name = self.sanitize_filename(title) + ".md"
                file_path = self.notes_dir / file_name

            # –û–±–Ω–æ–≤–ª—è–µ–º –∫–∞—Ç–µ–≥–æ—Ä–∏—é –≤ —Å–æ–¥–µ—Ä–∂–∏–º–æ–º
            lines = content.split('\n')
            updated_lines = []
            category_updated = False

            for line in lines:
                if line.lower().startswith("–∫–∞—Ç–µ–≥–æ—Ä–∏—è:"):
                    updated_lines.append(f"–ö–∞—Ç–µ–≥–æ—Ä–∏—è: {category}")
                    category_updated = True
                else:
                    updated_lines.append(line)

            # –ï—Å–ª–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏—è –Ω–µ –Ω–∞–π–¥–µ–Ω–∞, –¥–æ–±–∞–≤–ª—è–µ–º –µ—ë
            if not category_updated:
                # –ò—â–µ–º —Å—Ç—Ä–æ–∫—É –ø–æ—Å–ª–µ –∑–∞–≥–æ–ª–æ–≤–∫–∞
                for i, line in enumerate(updated_lines):
                    if line.startswith('# '):
                        # –í—Å—Ç–∞–≤–ª—è–µ–º –∫–∞—Ç–µ–≥–æ—Ä–∏—é –ø–æ—Å–ª–µ –∑–∞–≥–æ–ª–æ–≤–∫–∞
                        updated_lines.insert(i + 1, f"–ö–∞—Ç–µ–≥–æ—Ä–∏—è: {category}")
                        updated_lines.insert(i + 2, "")  # –ü—É—Å—Ç–∞—è —Å—Ç—Ä–æ–∫–∞
                        break

            content = '\n'.join(updated_lines)

            # –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ —Ñ–∞–π–ª
            with open(file_path, 'w', encoding='utf-8') as f:
                f.write(content)

            # –û–±–Ω–æ–≤–ª—è–µ–º –¥–∞—Ç—É –≤ Treeview
            selection = self.notes_tree.selection()
            if selection:
                current_date = datetime.now().strftime("%Y-%m-%d %H:%M")
                current_values = list(self.notes_tree.item(selection[0])["values"])

                if len(current_values) >= 5:
                    current_values[1] = title  # –ù–∞–∑–≤–∞–Ω–∏–µ
                    current_values[2] = category  # –ö–∞—Ç–µ–≥–æ—Ä–∏—è
                    current_values[4] = current_date  # –î–∞—Ç–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è

                    # –û–±–Ω–æ–≤–ª—è–µ–º –∏–º—è —Ñ–∞–π–ª–∞ –µ—Å–ª–∏ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å –Ω–∞–∑–≤–∞–Ω–∏–µ
                    old_file_name = current_values[5] if len(current_values) > 5 else ""
                    if old_file_name and title != self.current_note:
                        new_file_name = self.sanitize_filename(title) + ".md"
                        new_file_path = self.notes_dir / new_file_name

                        # –ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤—ã–≤–∞–µ–º —Ñ–∞–π–ª
                        if file_path.exists():
                            os.rename(file_path, new_file_path)
                            file_path = new_file_path

                        current_values[5] = new_file_name

                    self.notes_tree.item(selection[0], values=tuple(current_values))

                    # –û–±–Ω–æ–≤–ª—è–µ–º —Ç–µ–∫—É—â–∏–π –∫–æ–Ω—Å–ø–µ–∫—Ç
                    self.current_note = title
                    self.current_file_path = file_path

            messagebox.showinfo("–£—Å–ø–µ—Ö", f"–ö–æ–Ω—Å–ø–µ–∫—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω!\n\n–§–∞–π–ª: {file_path}")

        except Exception as e:
            messagebox.showerror("–û—à–∏–±–∫–∞", f"–ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –∫–æ–Ω—Å–ø–µ–∫—Ç: {e}")

    def delete_note(self):
        """–£–¥–∞–ª–µ–Ω–∏–µ –∫–æ–Ω—Å–ø–µ–∫—Ç–∞"""
        if not self.current_note:
            messagebox.showwarning("–í–Ω–∏–º–∞–Ω–∏–µ", "–í—ã–±–µ—Ä–∏—Ç–µ –∫–æ–Ω—Å–ø–µ–∫—Ç –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è!")
            return

        selection = self.notes_tree.selection()
        if not selection:
            return

        if messagebox.askyesno("–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ",
                               f"–£–¥–∞–ª–∏—Ç—å –∫–æ–Ω—Å–ø–µ–∫—Ç '{self.current_note}'?\n\n–§–∞–π–ª —Ç–∞–∫–∂–µ –±—É–¥–µ—Ç —É–¥–∞–ª–µ–Ω —Å –¥–∏—Å–∫–∞."):
            try:
                # –£–¥–∞–ª—è–µ–º —Ñ–∞–π–ª
                if self.current_file_path and self.current_file_path.exists():
                    os.remove(self.current_file_path)
                    print(f"üóëÔ∏è –£–¥–∞–ª–µ–Ω —Ñ–∞–π–ª: {self.current_file_path}")

                # –£–¥–∞–ª—è–µ–º –∏–∑ Treeview
                self.notes_tree.delete(selection[0])

                # –û—á–∏—â–∞–µ–º –ø–æ–ª—è
                self.title_entry.delete(0, tk.END)
                self.category_entry.delete(0, tk.END)
                self.editor.delete("1.0", tk.END)
                self.tags_label.config(text="–¢–µ–≥–∏ –Ω–µ –≤—ã–±—Ä–∞–Ω—ã")

                # –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Ç–µ–∫—É—â–∏–π –∫–æ–Ω—Å–ø–µ–∫—Ç
                self.current_note = None
                self.current_note_id = None
                self.current_file_path = None

                messagebox.showinfo("–£—Å–ø–µ—Ö", "–ö–æ–Ω—Å–ø–µ–∫—Ç —É–¥–∞–ª–µ–Ω!")

            except Exception as e:
                messagebox.showerror("–û—à–∏–±–∫–∞", f"–ù–µ —É–¥–∞–ª–æ—Å—å —É–¥–∞–ª–∏—Ç—å –∫–æ–Ω—Å–ø–µ–∫—Ç: {e}")

    def view_note(self):
        """–ü—Ä–æ—Å–º–æ—Ç—Ä –∫–æ–Ω—Å–ø–µ–∫—Ç–∞ –≤–æ –≤–Ω–µ—à–Ω–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏"""
        if not self.current_note:
            messagebox.showwarning("–í–Ω–∏–º–∞–Ω–∏–µ", "–í—ã–±–µ—Ä–∏—Ç–µ –∫–æ–Ω—Å–ø–µ–∫—Ç –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞!")
            return

        # –û–ø—Ä–µ–¥–µ–ª—è–µ–º –ø—É—Ç—å –∫ —Ñ–∞–π–ª—É
        if self.current_file_path and self.current_file_path.exists():
            file_path = self.current_file_path
        else:
            # –ü—ã—Ç–∞–µ–º—Å—è –Ω–∞–π—Ç–∏ —Ñ–∞–π–ª –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é
            file_name = self.sanitize_filename(self.current_note) + ".md"
            file_path = self.notes_dir / file_name

        if not file_path.exists():
            # –ò—â–µ–º –ª—é–±–æ–π —Ñ–∞–π–ª —Å —Ç–∞–∫–∏–º –Ω–∞–∑–≤–∞–Ω–∏–µ–º
            matching_files = list(self.notes_dir.glob(f"*{self.current_note}*.md"))
            if matching_files:
                file_path = matching_files[0]
            else:
                messagebox.showwarning("–í–Ω–∏–º–∞–Ω–∏–µ", "–§–∞–π–ª –∫–æ–Ω—Å–ø–µ–∫—Ç–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω!")
                return

        try:
            # –û—Ç–∫—Ä—ã–≤–∞–µ–º —Ñ–∞–π–ª –≤ –∞—Å—Å–æ—Ü–∏–∏—Ä–æ–≤–∞–Ω–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏
            print(f"üîç –û—Ç–∫—Ä—ã–≤–∞—é —Ñ–∞–π–ª: {file_path}")

            if platform.system() == 'Windows':
                os.startfile(str(file_path))
            elif platform.system() == 'Darwin':  # macOS
                subprocess.run(['open', str(file_path)])
            else:  # Linux
                subprocess.run(['xdg-open', str(file_path)])

            print(f"‚úÖ –§–∞–π–ª –æ—Ç–∫—Ä—ã—Ç: {file_path}")

        except Exception as e:
            messagebox.showerror("–û—à–∏–±–∫–∞", f"–ù–µ —É–¥–∞–ª–æ—Å—å –æ—Ç–∫—Ä—ã—Ç—å —Ñ–∞–π–ª: {e}")

    def open_exports_folder(self):
        """–û—Ç–∫—Ä—ã—Ç–∏–µ –ø–∞–ø–∫–∏ exports –≤ –ø—Ä–æ–≤–æ–¥–Ω–∏–∫–µ"""
        try:
            if platform.system() == 'Windows':
                os.startfile(str(self.exports_dir))
            elif platform.system() == 'Darwin':  # macOS
                subprocess.run(['open', str(self.exports_dir)])
            else:  # Linux
                subprocess.run(['xdg-open', str(self.exports_dir)])

            print(f"üìÇ –û—Ç–∫—Ä—ã—Ç–∞ –ø–∞–ø–∫–∞: {self.exports_dir}")
        except Exception as e:
            messagebox.showerror("–û—à–∏–±–∫–∞", f"–ù–µ —É–¥–∞–ª–æ—Å—å –æ—Ç–∫—Ä—ã—Ç—å –ø–∞–ø–∫—É: {e}")

    def sanitize_filename(self, filename):
        """–û—á–∏—Å—Ç–∫–∞ –∏–º–µ–Ω–∏ —Ñ–∞–π–ª–∞ –æ—Ç –Ω–µ–¥–æ–ø—É—Å—Ç–∏–º—ã—Ö —Å–∏–º–≤–æ–ª–æ–≤"""
        # –ó–∞–º–µ–Ω—è–µ–º –Ω–µ–¥–æ–ø—É—Å—Ç–∏–º—ã–µ —Å–∏–º–≤–æ–ª—ã
        invalid_chars = '<>:"/\\|?*'
        for char in invalid_chars:
            filename = filename.replace(char, '_')

        # –£–¥–∞–ª—è–µ–º –Ω–∞—á–∞–ª—å–Ω—ã–µ –∏ –∫–æ–Ω–µ—á–Ω—ã–µ —Ç–æ—á–∫–∏/–ø—Ä–æ–±–µ–ª—ã
        filename = filename.strip('. ')

        # –ï—Å–ª–∏ –∏–º—è –ø—É—Å—Ç–æ–µ, –∏—Å–ø–æ–ª—å–∑—É–µ–º "note"
        if not filename:
            filename = "note"

        return filename

    def add_tag(self):
        """–î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ç–µ–≥–∞ –∫ —Ç–µ–∫—É—â–µ–º—É –∫–æ–Ω—Å–ø–µ–∫—Ç—É"""
        tag = self.tag_entry.get().strip()
        if not tag:
            messagebox.showwarning("–í–Ω–∏–º–∞–Ω–∏–µ", "–í–≤–µ–¥–∏—Ç–µ —Ç–µ–≥!")
            return

        if not self.current_note:
            messagebox.showwarning("–í–Ω–∏–º–∞–Ω–∏–µ", "–í—ã–±–µ—Ä–∏—Ç–µ –∫–æ–Ω—Å–ø–µ–∫—Ç –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Ç–µ–≥–∞!")
            return

        # –ü–æ–ª—É—á–∞–µ–º —Ç–µ–∫—É—â–µ–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞
        content = self.editor.get("1.0", tk.END)
        lines = content.split('\n')

        # –ò—â–µ–º —Å—Ç—Ä–æ–∫—É —Å —Ç–µ–≥–∞–º–∏
        tag_line_index = -1
        for i, line in enumerate(lines):
            if line.lower().startswith("—Ç–µ–≥–∏:"):
                tag_line_index = i
                break

        if tag_line_index >= 0:
            # –û–±–Ω–æ–≤–ª—è–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é —Å—Ç—Ä–æ–∫—É —Å —Ç–µ–≥–∞–º–∏
            current_tags = lines[tag_line_index].split(":", 1)[1].strip()
            if current_tags:
                new_tags = current_tags + f", {tag}"
            else:
                new_tags = tag
            lines[tag_line_index] = f"–¢–µ–≥–∏: {new_tags}"
        else:
            # –î–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤—É—é —Å—Ç—Ä–æ–∫—É —Å —Ç–µ–≥–∞–º–∏ –≤ –∫–æ–Ω–µ—Ü
            lines.append(f"–¢–µ–≥–∏: {tag}")

        # –û–±–Ω–æ–≤–ª—è–µ–º —Ä–µ–¥–∞–∫—Ç–æ—Ä
        new_content = '\n'.join(lines)
        self.editor.delete("1.0", tk.END)
        self.editor.insert("1.0", new_content)

        # –û–±–Ω–æ–≤–ª—è–µ–º –º–µ—Ç–∫—É —Ç–µ–≥–æ–≤
        current_tags_display = self.tags_label.cget("text")
        if current_tags_display == "–¢–µ–≥–∏ –Ω–µ –≤—ã–±—Ä–∞–Ω—ã":
            new_display = f"–¢–µ–≥–∏: {tag}"
        else:
            new_display = current_tags_display + f", {tag}"
        self.tags_label.config(text=new_display)

        self.tag_entry.delete(0, tk.END)
        messagebox.showinfo("–£—Å–ø–µ—Ö", f"–¢–µ–≥ '{tag}' –¥–æ–±–∞–≤–ª–µ–Ω!")

    def generate_report(self):
        """–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç—á–µ—Ç–∞"""
        self.stats_text.config(state="normal")
        self.stats_text.delete("1.0", tk.END)

        try:
            # –°–æ–±–∏—Ä–∞–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø–æ —Ñ–∞–π–ª–∞–º
            total_notes = len(self.notes_tree.get_children())
            categories = {}
            files_by_date = {}
            all_tags = set()

            # –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º —Ñ–∞–π–ª—ã –≤ –ø–∞–ø–∫–µ
            for file_path in self.notes_dir.glob("*.md"):
                try:
                    mtime = os.path.getmtime(file_path)
                    mod_date = datetime.fromtimestamp(mtime)

                    # –ì—Ä—É–ø–ø–∏—Ä—É–µ–º –ø–æ –¥–∞—Ç–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è
                    date_str = mod_date.strftime("%Y-%m-%d")
                    files_by_date[date_str] = files_by_date.get(date_str, 0) + 1

                    # –ß–∏—Ç–∞–µ–º –∫–∞—Ç–µ–≥–æ—Ä–∏—é –∏ —Ç–µ–≥–∏ –∏–∑ —Ñ–∞–π–ª–∞
                    with open(file_path, 'r', encoding='utf-8') as f:
                        content = f.read()
                        lines = content.split('\n')

                        category = "–ë–µ–∑ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏"
                        for line in lines:
                            if line.lower().startswith("–∫–∞—Ç–µ–≥–æ—Ä–∏—è:"):
                                category = line.split(":", 1)[1].strip()
                                break

                        categories[category] = categories.get(category, 0) + 1

                        # –ò–∑–≤–ª–µ–∫–∞–µ–º —Ç–µ–≥–∏
                        for line in lines:
                            if line.lower().startswith("—Ç–µ–≥–∏:"):
                                tags_line = line.split(":", 1)[1].strip()
                                tags = [tag.strip() for tag in tags_line.split(',')]
                                all_tags.update(tags)
                                break

                except Exception as e:
                    print(f"‚ö†Ô∏è –û—à–∏–±–∫–∞ –ø—Ä–∏ –∞–Ω–∞–ª–∏–∑–µ —Ñ–∞–π–ª–∞ {file_path}: {e}")

            # –í—ã–≤–æ–¥–∏–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
            stats_text = f"""üìä –ê–ù–ê–õ–ò–¢–ò–ß–ï–°–ö–ò–ô –û–¢–ß–Å–¢
–î–∞—Ç–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏: {datetime.now().strftime('%Y-%m-%d %H:%M:%S')}
–ü–∞–ø–∫–∞ —Å –∑–∞–º–µ—Ç–∫–∞–º–∏: {self.notes_dir}
–ü–∞–ø–∫–∞ –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞: {self.exports_dir}
================================================

üìà –û–ë–©–ê–Ø –°–¢–ê–¢–ò–°–¢–ò–ö–ê:
  ‚Ä¢ –í—Å–µ–≥–æ –∫–æ–Ω—Å–ø–µ–∫—Ç–æ–≤: {total_notes}
  ‚Ä¢ –í—Å–µ–≥–æ —Ñ–∞–π–ª–æ–≤ –≤ –ø–∞–ø–∫–µ: {len(list(self.notes_dir.glob('*.md')))}
  ‚Ä¢ –†–∞–∑–º–µ—Ä –ø–∞–ø–∫–∏ notes_md: {self.get_folder_size(self.notes_dir):.2f} –ö–ë
  ‚Ä¢ –£–Ω–∏–∫–∞–ª—å–Ω—ã—Ö —Ç–µ–≥–æ–≤: {len(all_tags)}

üìÇ –†–ê–°–ü–†–ï–î–ï–õ–ï–ù–ò–ï –ü–û –ö–ê–¢–ï–ì–û–†–ò–Ø–ú:
"""
            for category, count in sorted(categories.items(), key=lambda x: x[1], reverse=True):
                percentage = (count / total_notes * 100) if total_notes > 0 else 0
                stats_text += f"  ‚Ä¢ {category}: {count} ({percentage:.1f}%)\n"

            # –ê–Ω–∞–ª–∏–∑ –ø–æ –¥–∞—Ç–∞–º
            recent_days = 7
            recent_files = []
            for date_str, count in sorted(files_by_date.items(), reverse=True):
                recent_files.append((date_str, count))
                if len(recent_files) >= recent_days:
                    break

            recent_count = sum(count for _, count in recent_files)

            stats_text += f"""
üìÖ –ê–ö–¢–ò–í–ù–û–°–¢–¨:
  ‚Ä¢ –ò–∑–º–µ–Ω–µ–Ω–æ –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 7 –¥–Ω–µ–π: {recent_count} —Ñ–∞–π–ª(–æ–≤)
  ‚Ä¢ –£–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –¥–∞—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π: {len(files_by_date)}
  ‚Ä¢ –°–∞–º—ã–µ –∞–∫—Ç–∏–≤–Ω—ã–µ –¥–∞—Ç—ã:"""

            for date_str, count in sorted(files_by_date.items(), key=lambda x: x[1], reverse=True)[:3]:
                stats_text += f"\n    - {date_str}: {count} —Ñ–∞–π–ª(–æ–≤)"

            if all_tags:
                stats_text += f"""
üè∑Ô∏è –ò–°–ü–û–õ–¨–ó–£–ï–ú–´–ï –¢–ï–ì–ò:
  {', '.join(sorted(all_tags))}
"""

            stats_text += f"""
üìã –¢–û–ü-5 –ü–û–°–õ–ï–î–ù–ò–• –§–ê–ô–õ–û–í:
"""
            # –ü–æ–ª—É—á–∞–µ–º –ø–æ—Å–ª–µ–¥–Ω–∏–µ 5 —Ñ–∞–π–ª–æ–≤ –ø–æ –¥–∞—Ç–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è
            files_with_dates = []
            for file_path in self.notes_dir.glob("*.md"):
                mtime = os.path.getmtime(file_path)
                files_with_dates.append((file_path, datetime.fromtimestamp(mtime)))

            files_with_dates.sort(key=lambda x: x[1], reverse=True)

            for i, (file_path, mod_date) in enumerate(files_with_dates[:5], 1):
                size_kb = os.path.getsize(file_path) / 1024
                stats_text += f"  {i}. {file_path.name} ({mod_date.strftime('%d.%m.%Y')}, {size_kb:.1f} –ö–ë)\n"

            stats_text += f"""
‚úÖ –û—Ç—á—ë—Ç –≥–æ—Ç–æ–≤ –∫ —ç–∫—Å–ø–æ—Ä—Ç—É!
–î–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Ñ–∞–π–ª–æ–≤ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–Ω–æ–ø–∫–∏ –Ω–∏–∂–µ.
"""

            self.stats_text.insert("1.0", stats_text)

        except Exception as e:
            self.stats_text.insert("1.0", f"–û—à–∏–±–∫–∞ –ø—Ä–∏ —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–∏ –æ—Ç—á—ë—Ç–∞: {str(e)}")

        self.stats_text.config(state="disabled")
        messagebox.showinfo("–û—Ç—á—ë—Ç", "–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å–æ–±—Ä–∞–Ω–∞! –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–Ω–æ–ø–∫–∏ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Ñ–∞–π–ª–æ–≤.")

    def create_excel_with_charts(self):
        """–°–æ–∑–¥–∞–Ω–∏–µ Excel —Ñ–∞–π–ª–∞ —Å –≥—Ä–∞—Ñ–∏–∫–∞–º–∏"""
        try:
            excel_file = self.exports_dir / f"report_{datetime.now().strftime('%Y%m%d_%H%M%S')}.xlsx"

            # –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏
            try:
                import openpyxl
                from openpyxl import Workbook
                from openpyxl.chart import BarChart, Reference, PieChart

                print(f"üìä –°–æ–∑–¥–∞—é Excel —Ñ–∞–π–ª: {excel_file}")

                # –°–æ–∑–¥–∞–µ–º —Ä–∞–±–æ—á—É—é –∫–Ω–∏–≥—É
                wb = Workbook()

                # ===== –õ–∏—Å—Ç 1: –î–∞–Ω–Ω—ã–µ =====
                ws_data = wb.active
                ws_data.title = "–î–∞–Ω–Ω—ã–µ"

                # –ó–∞–≥–æ–ª–æ–≤–∫–∏
                headers = ["ID", "–ù–∞–∑–≤–∞–Ω–∏–µ", "–ö–∞—Ç–µ–≥–æ—Ä–∏—è", "–°–æ–∑–¥–∞–Ω", "–û–±–Ω–æ–≤–ª–µ–Ω", "–§–∞–π–ª", "–†–∞–∑–º–µ—Ä (–ö–ë)"]
                ws_data.append(headers)

                # –î–∞–Ω–Ω—ã–µ –∏–∑ Treeview
                total_size = 0
                category_data = {}

                for child in self.notes_tree.get_children():
                    values = self.notes_tree.item(child)["values"]
                    if len(values) >= 5:
                        # –ü–æ–ª—É—á–∞–µ–º —Ä–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞
                        file_name = values[5] if len(values) > 5 else f"{values[1]}.md"
                        file_path = self.notes_dir / file_name

                        size_kb = 0
                        if file_path.exists():
                            size_kb = os.path.getsize(file_path) / 1024
                            total_size += size_kb

                        # –°–æ–±–∏—Ä–∞–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º
                        category = values[2] if len(values) > 2 else "–ë–µ–∑ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏"
                        category_data[category] = category_data.get(category, 0) + 1

                        # –î–æ–±–∞–≤–ª—è–µ–º —Å—Ç—Ä–æ–∫—É
                        row_data = list(values[:min(6, len(values))])
                        if len(row_data) < 6:
                            row_data.extend([""] * (6 - len(row_data)))
                        row_data.append(f"{size_kb:.1f}")
                        ws_data.append(row_data)

                # –ò—Ç–æ–≥–æ–≤–∞—è —Å—Ç—Ä–æ–∫–∞
                ws_data.append([])
                ws_data.append(["–ò–¢–û–ì–û:", "", "", "", "", f"–§–∞–π–ª–æ–≤: {len(self.notes_tree.get_children())}",
                                f"–†–∞–∑–º–µ—Ä: {total_size:.1f} –ö–ë"])

                # ===== –õ–∏—Å—Ç 2: –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ =====
                ws_stats = wb.create_sheet("–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞")

                # –ó–∞–≥–æ–ª–æ–≤–∫–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
                ws_stats.append(["–ö–∞—Ç–µ–≥–æ—Ä–∏—è", "–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ", "–ü—Ä–æ—Ü–µ–Ω—Ç"])

                # –î–∞–Ω–Ω—ã–µ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º
                total_notes = len(self.notes_tree.get_children())
                for category, count in sorted(category_data.items(), key=lambda x: x[1], reverse=True):
                    percentage = (count / total_notes * 100) if total_notes > 0 else 0
                    ws_stats.append([category, count, f"{percentage:.1f}%"])

                # –°–æ–∑–¥–∞–µ–º —Å—Ç–æ–ª–±—á–∞—Ç—É—é –¥–∏–∞–≥—Ä–∞–º–º—É
                chart1 = BarChart()
                chart1.title = "–ö–æ–Ω—Å–ø–µ–∫—Ç—ã –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º"
                chart1.x_axis.title = "–ö–∞—Ç–µ–≥–æ—Ä–∏–∏"
                chart1.y_axis.title = "–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ"

                data_ref = Reference(ws_stats, min_col=2, min_row=1, max_row=len(category_data) + 1)
                cats_ref = Reference(ws_stats, min_col=1, min_row=2, max_row=len(category_data) + 1)

                chart1.add_data(data_ref, titles_from_data=True)
                chart1.set_categories(cats_ref)

                ws_stats.add_chart(chart1, "E2")

                # ===== –õ–∏—Å—Ç 3: –ì—Ä–∞—Ñ–∏–∫–∏ =====
                ws_charts = wb.create_sheet("–ì—Ä–∞—Ñ–∏–∫–∏")

                # –ö—Ä—É–≥–æ–≤–∞—è –¥–∏–∞–≥—Ä–∞–º–º–∞
                chart2 = PieChart()
                chart2.title = "–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º"

                data_ref = Reference(ws_stats, min_col=2, min_row=2, max_row=len(category_data) + 1)
                cats_ref = Reference(ws_stats, min_col=1, min_row=2, max_row=len(category_data) + 1)

                chart2.add_data(data_ref, titles_from_data=True)
                chart2.set_categories(cats_ref)

                ws_charts.add_chart(chart2, "B2")

                # –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ñ–∞–π–ª
                wb.save(excel_file)

                messagebox.showinfo("–£—Å–ø–µ—Ö",
                                    f"Excel —Ñ–∞–π–ª —Å–æ–∑–¥–∞–Ω!\n\n–ü—É—Ç—å: {excel_file}\n\n–û—Ç–∫—Ä–æ–π—Ç–µ –ø–∞–ø–∫—É exports —á—Ç–æ–±—ã –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Ñ–∞–π–ª.")
                print(f"‚úÖ Excel —Ñ–∞–π–ª —Å–æ–∑–¥–∞–Ω: {excel_file}")

                # –ü—Ä–µ–¥–ª–∞–≥–∞–µ–º –æ—Ç–∫—Ä—ã—Ç—å –ø–∞–ø–∫—É
                if messagebox.askyesno("–û—Ç–∫—Ä—ã—Ç—å –ø–∞–ø–∫—É", "–û—Ç–∫—Ä—ã—Ç—å –ø–∞–ø–∫—É —Å —Ñ–∞–π–ª–æ–º?"):
                    self.open_exports_folder()

            except ImportError:
                messagebox.showwarning("–ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç",
                                       "–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ openpyxl: pip install openpyxl")

        except Exception as e:
            messagebox.showerror("–û—à–∏–±–∫–∞", f"–ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ–∑–¥–∞—Ç—å Excel —Ñ–∞–π–ª: {e}")
            print(f"‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ Excel: {e}")

    def create_pdf_report(self):
        """–°–æ–∑–¥–∞–Ω–∏–µ PDF –æ—Ç—á—ë—Ç–∞"""
        try:
            pdf_file = self.exports_dir / f"report_{datetime.now().strftime('%Y%m%d_%H%M%S')}.pdf"

            print(f"üìÑ –°–æ–∑–¥–∞—é PDF —Ñ–∞–π–ª: {pdf_file}")

            # –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏
            try:
                from reportlab.lib.pagesizes import A4
                from reportlab.pdfgen import canvas
                from reportlab.lib.units import cm
                from reportlab.lib.colors import HexColor

                # –°–æ–∑–¥–∞–µ–º PDF
                c = canvas.Canvas(str(pdf_file), pagesize=A4)
                width, height = A4

                # –ù–∞—Å—Ç—Ä–æ–π–∫–∏
                margin = 2 * cm
                line_height = 14
                y = height - margin

                # ===== –ó–∞–≥–æ–ª–æ–≤–æ–∫ =====
                c.setFont("Helvetica-Bold", 18)
                c.setFillColor(HexColor("#2c3e50"))
                c.drawString(margin, y, "–ê–ù–ê–õ–ò–¢–ò–ß–ï–°–ö–ò–ô –û–¢–ß–Å–¢")
                y -= line_height * 2

                c.setFont("Helvetica", 10)
                c.setFillColor(HexColor("#7f8c8d"))
                c.drawString(margin, y, f"–ñ—É—Ä–Ω–∞–ª –∑–Ω–∞–Ω–∏–π - {datetime.now().strftime('%d.%m.%Y %H:%M')}")
                y -= line_height * 2

                # –õ–∏–Ω–∏—è
                c.setStrokeColor(HexColor("#3498db"))
                c.setLineWidth(1)
                c.line(margin, y, width - margin, y)
                y -= line_height * 2

                # ===== –û–±—â–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è =====
                c.setFont("Helvetica-Bold", 12)
                c.setFillColor(HexColor("#2c3e50"))
                c.drawString(margin, y, "–û–ë–©–ê–Ø –ò–ù–§–û–†–ú–ê–¶–ò–Ø:")
                y -= line_height

                c.setFont("Helvetica", 10)
                c.setFillColor(HexColor("#2c3e50"))

                info_lines = [
                    f"‚Ä¢ –í—Å–µ–≥–æ –∫–æ–Ω—Å–ø–µ–∫—Ç–æ–≤: {len(self.notes_tree.get_children())}",
                    f"‚Ä¢ –ü–∞–ø–∫–∞ —Å –∑–∞–º–µ—Ç–∫–∞–º–∏: {self.notes_dir}",
                    f"‚Ä¢ –î–∞—Ç–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏: {datetime.now().strftime('%d.%m.%Y %H:%M:%S')}"
                ]

                for line in info_lines:
                    c.drawString(margin + 0.5 * cm, y, line)
                    y -= line_height

                y -= line_height

                # ===== –°–ø–∏—Å–æ–∫ –∫–æ–Ω—Å–ø–µ–∫—Ç–æ–≤ =====
                c.setFont("Helvetica-Bold", 12)
                c.drawString(margin, y, "–°–ü–ò–°–û–ö –ö–û–ù–°–ü–ï–ö–¢–û–í:")
                y -= line_height

                c.setFont("Helvetica", 9)
                headers = ["‚Ññ", "–ù–∞–∑–≤–∞–Ω–∏–µ", "–ö–∞—Ç–µ–≥–æ—Ä–∏—è", "–û–±–Ω–æ–≤–ª–µ–Ω"]
                col_widths = [1 * cm, 8 * cm, 4 * cm, 3 * cm]

                # –ó–∞–≥–æ–ª–æ–≤–∫–∏ —Ç–∞–±–ª–∏—Ü—ã
                x = margin
                for header, col_width in zip(headers, col_widths):
                    c.drawString(x, y, header)
                    x += col_width

                y -= line_height
                c.setStrokeColor(HexColor("#bdc3c7"))
                c.line(margin, y, width - margin, y)
                y -= line_height

                # –î–∞–Ω–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã
                c.setFont("Helvetica", 8)
                row_num = 1

                for child in self.notes_tree.get_children():
                    values = self.notes_tree.item(child)["values"]
                    if len(values) >= 3:
                        # –ü—Ä–æ–≤–µ—Ä—è–µ–º, –ø–æ–º–µ—â–∞–µ–º—Å—è –ª–∏ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ
                        if y < margin + 3 * cm:
                            c.showPage()
                            y = height - margin
                            c.setFont("Helvetica", 8)

                        x = margin
                        row_data = [
                            str(row_num),
                            values[1] if len(values) > 1 else "",
                            values[2] if len(values) > 2 else "",
                            values[4] if len(values) > 4 else ""
                        ]

                        for i, (data, col_width) in enumerate(zip(row_data, col_widths)):
                            # –û–±—Ä–µ–∑–∞–µ–º –¥–ª–∏–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç
                            if i == 1 and len(data) > 40:
                                data = data[:37] + "..."
                            c.drawString(x, y, data)
                            x += col_width

                        y -= line_height
                        row_num += 1

                        # –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å—Ç—Ä–æ–∫ –¥–ª—è –ø–µ—Ä–≤–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã
                        if row_num > 15 and y > margin + 3 * cm:
                            break

                # ===== –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ =====
                c.showPage()
                y = height - margin

                c.setFont("Helvetica-Bold", 12)
                c.setFillColor(HexColor("#2c3e50"))
                c.drawString(margin, y, "–°–¢–ê–¢–ò–°–¢–ò–ö–ê:")
                y -= line_height * 2

                # –°–æ–±–∏—Ä–∞–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
                categories = {}
                for child in self.notes_tree.get_children():
                    values = self.notes_tree.item(child)["values"]
                    if len(values) > 2:
                        category = values[2]
                        categories[category] = categories.get(category, 0) + 1

                c.setFont("Helvetica", 10)
                c.drawString(margin, y, "–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º:")
                y -= line_height

                for category, count in sorted(categories.items(), key=lambda x: x[1], reverse=True):
                    percentage = (count / len(
                        self.notes_tree.get_children()) * 100) if self.notes_tree.get_children() else 0
                    c.drawString(margin + 0.5 * cm, y, f"‚Ä¢ {category}: {count} ({percentage:.1f}%)")
                    y -= line_height

                y -= line_height

                # ===== –ü–æ–¥–≤–∞–ª =====
                c.setFont("Helvetica-Oblique", 8)
                c.setFillColor(HexColor("#95a5a6"))
                c.drawString(margin, margin / 2, f"–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ–º '–ê–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏–π –∂—É—Ä–Ω–∞–ª –∑–Ω–∞–Ω–∏–π'")
                c.drawString(width - margin - 6 * cm, margin / 2, f"–°—Ç—Ä–∞–Ω–∏—Ü–∞ 2 –∏–∑ 2")

                # –°–æ—Ö—Ä–∞–Ω—è–µ–º PDF
                c.save()

                messagebox.showinfo("–£—Å–ø–µ—Ö",
                                    f"PDF –æ—Ç—á—ë—Ç —Å–æ–∑–¥–∞–Ω!\n\n–ü—É—Ç—å: {pdf_file}\n\n–û—Ç–∫—Ä–æ–π—Ç–µ –ø–∞–ø–∫—É exports —á—Ç–æ–±—ã –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Ñ–∞–π–ª.")
                print(f"‚úÖ PDF —Ñ–∞–π–ª —Å–æ–∑–¥–∞–Ω: {pdf_file}")

                # –ü—Ä–µ–¥–ª–∞–≥–∞–µ–º –æ—Ç–∫—Ä—ã—Ç—å –ø–∞–ø–∫—É
                if messagebox.askyesno("–û—Ç–∫—Ä—ã—Ç—å –ø–∞–ø–∫—É", "–û—Ç–∫—Ä—ã—Ç—å –ø–∞–ø–∫—É —Å —Ñ–∞–π–ª–æ–º?"):
                    self.open_exports_folder()

            except ImportError:
                messagebox.showwarning("–ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç",
                                       "–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ reportlab: pip install reportlab")

        except Exception as e:
            messagebox.showerror("–û—à–∏–±–∫–∞", f"–ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ–∑–¥–∞—Ç—å PDF: {e}")
            print(f"‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ PDF: {e}")

    def export_to_excel(self):
        """–≠–∫—Å–ø–æ—Ä—Ç –ø—Ä–æ—Å—Ç–æ–≥–æ Excel —Ñ–∞–π–ª–∞ (–¥–ª—è –æ–±—Ä–∞—Ç–Ω–æ–π —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏)"""
        self.create_excel_with_charts()

    def export_to_pdf(self):
        """–≠–∫—Å–ø–æ—Ä—Ç –ø—Ä–æ—Å—Ç–æ–≥–æ PDF —Ñ–∞–π–ª–∞ (–¥–ª—è –æ–±—Ä–∞—Ç–Ω–æ–π —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏)"""
        self.create_pdf_report()

    def get_folder_size(self, folder_path):
        """–ü–æ–ª—É—á–µ–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–∞ –ø–∞–ø–∫–∏ –≤ –∫–∏–ª–æ–±–∞–π—Ç–∞—Ö"""
        total_size = 0
        for file_path in folder_path.rglob('*'):
            if file_path.is_file():
                total_size += file_path.stat().st_size
        return total_size / 1024

    def run(self):
        """–ó–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è"""
        self.root.mainloop()


if __name__ == "__main__":
    app = KnowledgeJournalApp()
    app.run()
```
