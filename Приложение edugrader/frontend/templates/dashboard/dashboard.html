{% extends "base.html" %}

{% block title %}–î–∞—à–±–æ—Ä–¥{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="/static/css/dashboard.css">
{% endblock %}

{% block content %}
<div class="dashboard-header">
    <h1>–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, {{ user.full_name.split()[0] }}!</h1>
    <p class="date">{{ now.strftime('%d %B %Y') }}</p>
</div>

<!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
<div class="stats-grid">
    <div class="stat-card">
        <div class="stat-icon">üìö</div>
        <div class="stat-content">
            <div class="stat-value">{{ total_courses }}</div>
            <div class="stat-label">–ê–∫—Ç–∏–≤–Ω—ã—Ö –∫—É—Ä—Å–æ–≤</div>
        </div>
    </div>
    
    {% if user.role == 'student' %}
    <div class="stat-card">
        <div class="stat-icon">üìù</div>
        <div class="stat-content">
            <div class="stat-value">{{ pending_assignments }}</div>
            <div class="stat-label">–ó–∞–¥–∞–Ω–∏–π –Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫—É</div>
        </div>
    </div>
    {% elif user.role == 'teacher' %}
    <div class="stat-card">
        <div class="stat-icon">‚úÖ</div>
        <div class="stat-content">
            <div class="stat-value">{{ pending_reviews }}</div>
            <div class="stat-label">–û–∂–∏–¥–∞—é—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏</div>
        </div>
    </div>
    {% endif %}
    
    {% if user.role == 'student' %}
    <div class="stat-card">
        <div class="stat-icon">‚≠ê</div>
        <div class="stat-content">
            <div class="stat-value">{{ recent_grades|length }}</div>
            <div class="stat-label">–ù–æ–≤—ã—Ö –æ—Ü–µ–Ω–æ–∫</div>
        </div>
    </div>
    {% endif %}
    
    <div class="stat-card">
        <div class="stat-icon">‚è∞</div>
        <div class="stat-content">
            <div class="stat-value">{{ deadlines|length if deadlines else 0 }}</div>
            <div class="stat-label">–ë–ª–∏–∂–∞–π—à–∏—Ö –¥–µ–¥–ª–∞–π–Ω–æ–≤</div>
        </div>
    </div>
</div>

<!-- –°–µ—Ç–∫–∞ –¥–∞—à–±–æ—Ä–¥–∞ -->
<div class="dashboard-grid">
    <!-- –ú–æ–∏ –∫—É—Ä—Å—ã -->
    <div class="dashboard-card">
        <h3>–ú–æ–∏ –∫—É—Ä—Å—ã</h3>
        
        {% if courses %}
        <div class="courses-list">
            {% for course in courses %}
            <div class="course-item">
                <a href="/courses/{{ course.id }}" class="course-link">
                    <h4>{{ course.name }}</h4>
                    <p class="course-meta">{{ course.code }} ‚Ä¢ {{ course.teacher.full_name }}</p>
                </a>
            </div>
            {% endfor %}
        </div>
        <a href="/courses" class="card-link">–í—Å–µ –∫—É—Ä—Å—ã ‚Üí</a>
        {% else %}
        <p class="empty-message">–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –∫—É—Ä—Å–æ–≤</p>
        {% if user.role == 'student' %}
        <a href="/courses" class="btn btn-secondary">–ù–∞–π—Ç–∏ –∫—É—Ä—Å—ã</a>
        {% elif user.role == 'teacher' %}
        <a href="/courses/create" class="btn btn-primary">–°–æ–∑–¥–∞—Ç—å –∫—É—Ä—Å</a>
        {% endif %}
        {% endif %}
    </div>
    
    {% if user.role == 'student' %}
    <!-- –ë–ª–∏–∂–∞–π—à–∏–µ –¥–µ–¥–ª–∞–π–Ω—ã -->
    <div class="dashboard-card">
        <h3>–ë–ª–∏–∂–∞–π—à–∏–µ –¥–µ–¥–ª–∞–π–Ω—ã</h3>
        
        {% if deadlines %}
        <div class="deadlines-list">
            {% for assignment in deadlines %}
            {% set days_left = (assignment.due_date - now).days %}
            <div class="deadline-item 
                {% if days_left <= 2 %}urgent
                {% elif days_left <= 5 %}warning
                {% else %}normal{% endif %}">
                <a href="/assignments/{{ assignment.id }}" class="deadline-link">
                    <h4>{{ assignment.title }}</h4>
                    <p class="deadline-course">{{ assignment.course.name }}</p>
                    <div class="deadline-date">
                        <span class="days-left">{{ days_left }} –¥–Ω.</span>
                        <small>{{ assignment.due_date.strftime('%d.%m.%Y') }}</small>
                    </div>
                </a>
            </div>
            {% endfor %}
        </div>
        {% else %}
        <p class="empty-message">–ù–µ—Ç –±–ª–∏–∂–∞–π—à–∏—Ö –¥–µ–¥–ª–∞–π–Ω–æ–≤</p>
        {% endif %}
    </div>
    
    <!-- –ü–æ—Å–ª–µ–¥–Ω–∏–µ –æ—Ü–µ–Ω–∫–∏ -->
    <div class="dashboard-card">
        <h3>–ü–æ—Å–ª–µ–¥–Ω–∏–µ –æ—Ü–µ–Ω–∫–∏</h3>
        
        {% if recent_grades %}
        <div class="grades-list">
            {% for grade in recent_grades %}
            {% set percentage = (grade.total_score / grade.max_score * 100)|int %}
            <div class="grade-item">
                <a href="/submissions/{{ grade.submission_id }}" class="grade-link">
                    <h4>{{ grade.assignment.title }}</h4>
                    <p class="grade-course">{{ grade.assignment.course.name }}</p>
                    <div class="grade-value 
                        {% if percentage >= 90 %}grade-a
                        {% elif percentage >= 75 %}grade-b
                        {% elif percentage >= 60 %}grade-c
                        {% else %}grade-f{% endif %}">
                        {{ grade.total_score }}/{{ grade.max_score }}
                    </div>
                </a>
            </div>
            {% endfor %}
        </div>
        <a href="/grades" class="card-link">–í—Å–µ –æ—Ü–µ–Ω–∫–∏ ‚Üí</a>
        {% else %}
        <p class="empty-message">–ü–æ–∫–∞ –Ω–µ—Ç –æ—Ü–µ–Ω–æ–∫</p>
        {% endif %}
    </div>
    
    {% elif user.role == 'teacher' %}
    <!-- –†–∞–±–æ—Ç—ã –Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫—É -->
    <div class="dashboard-card">
        <h3>–û–∂–∏–¥–∞—é—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏</h3>
        
        <div class="pending-list">
            <p>–£ –≤–∞—Å {{ pending_reviews }} —Ä–∞–±–æ—Ç –Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–µ</p>
            <a href="/submissions?status=submitted" class="btn btn-primary">
                –ü–µ—Ä–µ–π—Ç–∏ –∫ –ø—Ä–æ–≤–µ—Ä–∫–µ
            </a>
        </div>
    </div>
    
    <!-- –ë—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è -->
    <div class="dashboard-card">
        <h3>–ë—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è</h3>
        
        <div class="quick-actions">
            <a href="/courses/create" class="action-btn">‚ûï –°–æ–∑–¥–∞—Ç—å –∫—É—Ä—Å</a>
            <a href="/submissions?status=submitted" class="action-btn">üìù –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–±–æ—Ç—ã</a>
        </div>
    </div>
    {% endif %}
    
    {% if user.role == 'admin' %}
    <!-- –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å -->
    <div class="dashboard-card">
        <h3>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º–æ–π</h3>
        
        <div class="admin-stats">
            <p>üë• –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π: {{ total_users }}</p>
            <p>üìö –ö—É—Ä—Å–æ–≤: {{ total_courses }}</p>
            <p>üìù –ó–∞–¥–∞–Ω–∏–π: {{ total_assignments }}</p>
        </div>
        
        <div class="admin-actions">
            <a href="/admin/users" class="action-btn">üë• –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏</a>
            <a href="/admin/import-users" class="action-btn">üì• –ò–º–ø–æ—Ä—Ç –∏–∑ CSV</a>
        </div>
    </div>
    {% endif %}
</div>
{% endblock %}