{% extends "base.html" %}

{% block title %}Профиль{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="/static/css/profile.css">
{% endblock %}

{% block content %}
<div class="profile-container">
    <div class="profile-header">
        <div class="profile-avatar">
            {{ user.full_name[:1] }}
        </div>
        
        <h1 class="profile-name">{{ user.full_name }}</h1>
        <p class="profile-role">
            {% if user.role == 'student' %}Студент
            {% elif user.role == 'teacher' %}Преподаватель
            {% elif user.role == 'admin' %}Администратор
            {% endif %}
        </p>
    </div>
    
    <div class="profile-content">
        <!-- Информация о пользователе -->
        <div class="profile-card">
            <h2>Личная информация</h2>
            
            <form method="POST" action="/profile/update" class="profile-form">
                <div class="form-group">
                    <label>Email</label>
                    <input type="email" value="{{ user.email }}" disabled class="disabled">
                </div>
                
                <div class="form-group">
                    <label for="full_name">Полное имя</label>
                    <input 
                        type="text" 
                        id="full_name" 
                        name="full_name" 
                        value="{{ user.full_name }}" 
                        required
                    >
                </div>
                
                <div class="form-group">
                    <label for="phone">Телефон</label>
                    <input 
                        type="tel" 
                        id="phone" 
                        name="phone" 
                        value="{{ user.phone or '' }}"
                        placeholder="+7 (999) 999-99-99"
                    >
                </div>
                
                {% if user.role == 'student' %}
                <div class="form-group">
                    <label for="group">Группа</label>
                    <input 
                        type="text" 
                        id="group" 
                        name="group" 
                        value="{{ user.group or '' }}"
                        placeholder="Например: 21ИС-24"
                    >
                </div>
                {% endif %}
                
                <button type="submit" class="btn btn-primary">Сохранить изменения</button>
            </form>
        </div>
        
        <!-- Смена пароля -->
        <div class="profile-card">
            <h2>Смена пароля</h2>
            
            <form method="POST" action="/profile/change-password" class="password-form">
                <div class="form-group">
                    <label for="current_password">Текущий пароль</label>
                    <input type="password" id="current_password" name="current_password" required>
                </div>
                
                <div class="form-group">
                    <label for="new_password">Новый пароль</label>
                    <input type="password" id="new_password" name="new_password" required>
                    <small class="hint">Минимум 8 символов</small>
                </div>
                
                <div class="form-group">
                    <label for="confirm_password">Подтверждение пароля</label>
                    <input type="password" id="confirm_password" name="confirm_password" required>
                </div>
                
                <button type="submit" class="btn btn-primary">Изменить пароль</button>
            </form>
        </div>
        
        <!-- Статистика -->
        <div class="profile-card">
            <h2>Статистика</h2>
            
            <div class="stats-list">
                <div class="stat-row">
                    <span class="stat-label">Дата регистрации:</span>
                    <span class="stat-value">{{ user.created_at.strftime('%d.%m.%Y') }}</span>
                </div>
                
                <div class="stat-row">
                    <span class="stat-label">Последний вход:</span>
                    <span class="stat-value">
                        {{ user.last_login_at.strftime('%d.%m.%Y %H:%M') if user.last_login_at else 'Никогда' }}
                    </span>
                </div>
                
                {% if user.role == 'student' %}
                <div class="stat-row">
                    <span class="stat-label">Всего курсов:</span>
                    <span class="stat-value">{{ user.courses_enrolled|length }}</span>
                </div>
                
                <div class="stat-row">
                    <span class="stat-label">Всего оценок:</span>
                    <span class="stat-value">{{ user.grades_received|length }}</span>
                </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>
{% endblock %}