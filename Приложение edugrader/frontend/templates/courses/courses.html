{% extends "base.html" %}

{% block title %}–ö—É—Ä—Å—ã{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="/static/css/courses.css">
{% endblock %}

{% block content %}
<div class="courses-header">
    <h1>–ú–æ–∏ –∫—É—Ä—Å—ã</h1>
    
    {% if user.role in ['teacher', 'admin'] %}
    <a href="/courses/create" class="btn btn-primary">–°–æ–∑–¥–∞—Ç—å –∫—É—Ä—Å</a>
    {% endif %}
</div>

<!-- –ü–æ–∏—Å–∫ –∏ —Ñ–∏–ª—å—Ç—Ä—ã -->
<div class="courses-filters">
    <form method="GET" action="/courses" class="search-form">
        <input 
            type="text" 
            name="search" 
            placeholder="–ü–æ–∏—Å–∫ –∫—É—Ä—Å–æ–≤..." 
            value="{{ search }}"
            class="search-input"
        >
        <button type="submit" class="btn btn-primary">–ù–∞–π—Ç–∏</button>
        {% if search %}
        <a href="/courses" class="btn btn-secondary">–°–±—Ä–æ—Å–∏—Ç—å</a>
        {% endif %}
    </form>
</div>

<!-- –°–µ—Ç–∫–∞ –∫—É—Ä—Å–æ–≤ -->
{% if courses %}
<div class="courses-grid">
    {% for course in courses %}
    <div class="course-card">
        <div class="course-header">
            <span class="course-code">{{ course.code }}</span>
            <span class="course-status status-{{ course.status.value }}">
                {{ course.status.value }}
            </span>
        </div>
        
        <h3>{{ course.name }}</h3>
        
        <p class="course-description">
            {{ course.description[:100] if course.description else '–ù–µ—Ç –æ–ø–∏—Å–∞–Ω–∏—è' }}
            {% if course.description and course.description|length > 100 %}...{% endif %}
        </p>
        
        <div class="course-meta">
            <span>üìö {{ course.assignments|length }} –∑–∞–¥–∞–Ω–∏–π</span>
            <span>üë• {{ course.students|length }}/{{ course.max_students }}</span>
        </div>
        
        <p class="course-teacher">–ü—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—å: {{ course.teacher.full_name }}</p>
        
        <div class="course-actions">
            <a href="/courses/{{ course.id }}" class="btn btn-primary">–ü–æ–¥—Ä–æ–±–Ω–µ–µ</a>
            
            {% if user.role == 'teacher' and course.teacher_id == user.id %}
            <a href="/courses/{{ course.id }}/edit" class="btn btn-secondary">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</a>
            {% endif %}
            
            {% if user.role == 'student' and user not in course.students and course.students|length < course.max_students %}
            <form method="POST" action="/courses/{{ course.id }}/enroll" style="display: inline;">
                <button type="submit" class="btn btn-success">–ó–∞–ø–∏—Å–∞—Ç—å—Å—è</button>
            </form>
            {% endif %}
        </div>
    </div>
    {% endfor %}
</div>

<!-- –ü–∞–≥–∏–Ω–∞—Ü–∏—è -->
{% if total_pages > 1 %}
<div class="pagination">
    {% if page > 1 %}
    <a href="/courses?page={{ page-1 }}{% if search %}&search={{ search }}{% endif %}" class="page-link">
        ‚Üê
    </a>
    {% endif %}
    
    {% for p in range(1, total_pages + 1) %}
        {% if p == page %}
        <span class="page-current">{{ p }}</span>
        {% else %}
        <a href="/courses?page={{ p }}{% if search %}&search={{ search }}{% endif %}" class="page-link">
            {{ p }}
        </a>
        {% endif %}
    {% endfor %}
    
    {% if page < total_pages %}
    <a href="/courses?page={{ page+1 }}{% if search %}&search={{ search }}{% endif %}" class="page-link">
        ‚Üí
    </a>
    {% endif %}
</div>
{% endif %}

{% else %}
<div class="empty-state">
    <p>–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –∫—É—Ä—Å–æ–≤</p>
    
    {% if user.role == 'student' %}
    <p>–í—ã –º–æ–∂–µ—Ç–µ –Ω–∞–π—Ç–∏ –∫—É—Ä—Å—ã –≤ –∫–∞—Ç–∞–ª–æ–≥–µ</p>
    <a href="/courses" class="btn btn-primary">–û–±–Ω–æ–≤–∏—Ç—å —Å–ø–∏—Å–æ–∫</a>
    {% elif user.role == 'teacher' %}
    <p>–°–æ–∑–¥–∞–π—Ç–µ —Å–≤–æ–π –ø–µ—Ä–≤—ã–π –∫—É—Ä—Å</p>
    <a href="/courses/create" class="btn btn-primary">–°–æ–∑–¥–∞—Ç—å –∫—É—Ä—Å</a>
    {% endif %}
</div>
{% endif %}
{% endblock %}