<!DOCTYPE html>
<html>
<head>
    <title>EduGrader –†–∞–±–æ—á–∏–π —Ç–µ—Å—Ç–µ—Ä</title>
    <style>
        body { font-family: Arial; padding: 20px; max-width: 800px; margin: 0 auto; background: #f5f5f5; }
        .container { background: white; padding: 25px; border-radius: 15px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .tabs { display: flex; margin-bottom: 20px; border-bottom: 2px solid #ddd; }
        .tab { padding: 10px 20px; cursor: pointer; background: #f5f5f5; border: 1px solid #ddd; margin-right: 5px; border-radius: 5px 5px 0 0; }
        .tab.active { background: #1a73e8; color: white; border-color: #1a73e8; }
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        .section { background: #f9f9f9; padding: 20px; border-radius: 10px; margin: 20px 0; }
        input, select, textarea, button { width: 100%; padding: 12px; margin: 8px 0; border: 1px solid #ddd; border-radius: 8px; box-sizing: border-box; font-size: 14px; }
        button { background: #1a73e8; color: white; border: none; cursor: pointer; font-size: 16px; font-weight: bold; }
        button:hover { background: #1557b0; }
        button:disabled { background: #ccc; cursor: not-allowed; }
        pre { background: #f8f9fa; padding: 15px; border-radius: 8px; overflow: auto; max-height: 300px; border: 1px solid #e0e0e0; }
        .success { background: #d4edda; color: #155724; padding: 12px; border-radius: 8px; margin: 10px 0; border: 1px solid #c3e6cb; }
        .error { background: #f8d7da; color: #721c24; padding: 12px; border-radius: 8px; margin: 10px 0; border: 1px solid #f5c6cb; }
        .info { background: #e7f3ff; padding: 12px; border-radius: 8px; margin: 10px 0; border: 1px solid #b8daff; }
        .token-box { background: #e8f0fe; padding: 10px; border-radius: 5px; margin: 10px 0; word-break: break-all; font-family: monospace; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üìö EduGrader - –†–∞–±–æ—á–µ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ</h1>
        
        <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å–µ—Ä–≤–µ—Ä–µ -->
        <div class="info" id="serverInfo">
            üîÑ –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ —Å–µ—Ä–≤–µ—Ä—É...
        </div>

        <!-- –¢–æ–∫–µ–Ω –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è -->
        <div id="tokenInfo" class="token-box" style="display: none;">
            <strong>üîë –¢–æ–∫–µ–Ω:</strong> <span id="tokenValue"></span><br>
            <button onclick="logout()" style="width: auto; padding: 5px 10px; margin-top: 5px;">–í—ã–π—Ç–∏</button>
        </div>

        <!-- –í–∫–ª–∞–¥–∫–∏ -->
        <div class="tabs">
            <div class="tab active" onclick="showTab('auth')">üîê –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è</div>
            <div class="tab" onclick="showTab('courses')">üìö –ö—É—Ä—Å—ã</div>
            <div class="tab" onclick="showTab('profile')">üë§ –ü—Ä–æ—Ñ–∏–ª—å</div>
        </div>

        <!-- –í–∫–ª–∞–¥–∫–∞ –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è -->
        <div id="auth" class="tab-content active">
            <div class="section">
                <h3>üîê –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</h3>
                <input type="email" id="reg-email" placeholder="Email" value="test@example.com">
                <input type="text" id="reg-username" placeholder="Username" value="testuser">
                <input type="text" id="reg-fullname" placeholder="Full Name" value="–¢–µ—Å—Ç–æ–≤—ã–π –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å">
                <input type="password" id="reg-password" placeholder="Password" value="password123">
                <select id="reg-role">
                    <option value="student">–°—Ç—É–¥–µ–Ω—Ç</option>
                    <option value="teacher">–ü—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—å</option>
                </select>
                <button onclick="register()">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è</button>
            </div>

            <div class="section">
                <h3>üîë –í—Ö–æ–¥</h3>
                <input type="text" id="login-username" placeholder="Username" value="testuser">
                <input type="password" id="login-password" placeholder="Password" value="password123">
                <button onclick="login()">–í–æ–π—Ç–∏</button>
            </div>

            <div class="section">
                <h3>üîÑ –°–±—Ä–æ—Å –ø–∞—Ä–æ–ª—è</h3>
                <input type="email" id="reset-email" placeholder="Email" value="test@example.com">
                <button onclick="resetPasswordRequest()">–ó–∞–ø—Ä–æ—Å–∏—Ç—å —Å–±—Ä–æ—Å</button>
                <input type="text" id="reset-token" placeholder="Token –∏–∑ email">
                <input type="password" id="new-password" placeholder="–ù–æ–≤—ã–π –ø–∞—Ä–æ–ª—å">
                <button onclick="resetPasswordConfirm()">–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å —Å–±—Ä–æ—Å</button>
            </div>
        </div>

        <!-- –í–∫–ª–∞–¥–∫–∞ –ö—É—Ä—Å—ã -->
        <div id="courses" class="tab-content">
            <div class="section">
                <h3>üìã –ú–æ–∏ –∫—É—Ä—Å—ã</h3>
                <button onclick="getCourses()">–ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –∫—É—Ä—Å–æ–≤</button>
            </div>

            <div class="section">
                <h3>‚ûï –°–æ–∑–¥–∞—Ç—å –∫—É—Ä—Å</h3>
                <input type="text" id="course-name" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ" value="Python Programming">
                <input type="text" id="course-code" placeholder="–ö–æ–¥ –∫—É—Ä—Å–∞" value="PY101">
                <textarea id="course-description" placeholder="–û–ø–∏—Å–∞–Ω–∏–µ">–û—Å–Ω–æ–≤—ã –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—è –Ω–∞ Python</textarea>
                <input type="text" id="course-year" placeholder="–£—á–µ–±–Ω—ã–π –≥–æ–¥" value="2024">
                <input type="number" id="course-semester" placeholder="–°–µ–º–µ—Å—Ç—Ä" value="1">
                <button onclick="createCourse()">–°–æ–∑–¥–∞—Ç—å –∫—É—Ä—Å</button>
            </div>

            <div class="section">
                <h3>üìù –ó–∞–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ –∫—É—Ä—Å</h3>
                <input type="number" id="course-id" placeholder="ID –∫—É—Ä—Å–∞">
                <button onclick="enrollCourse()">–ó–∞–ø–∏—Å–∞—Ç—å—Å—è</button>
            </div>
        </div>

        <!-- –í–∫–ª–∞–¥–∫–∞ –ü—Ä–æ—Ñ–∏–ª—å -->
        <div id="profile" class="tab-content">
            <div class="section">
                <h3>üë§ –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ</h3>
                <button onclick="getUserInfo()">–ü–æ–ª—É—á–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é</button>
            </div>
        </div>

        <!-- –†–µ–∑—É–ª—å—Ç–∞—Ç -->
        <div class="section">
            <h3>üìã –†–µ–∑—É–ª—å—Ç–∞—Ç</h3>
            <pre id="result">–û–∂–∏–¥–∞–Ω–∏–µ –¥–µ–π—Å—Ç–≤–∏—è...</pre>
        </div>
    </div>

    <script>
        const BASE_URL = 'http://127.0.0.1:8000/api';
        let token = localStorage.getItem('token') || '';

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        window.onload = async function() {
            const serverInfo = document.getElementById('serverInfo');
            try {
                const response = await fetch('http://127.0.0.1:8000/');
                if (response.ok) {
                    serverInfo.className = 'success';
                    serverInfo.innerHTML = '‚úÖ –°–µ—Ä–≤–µ—Ä –ø–æ–¥–∫–ª—é—á–µ–Ω! http://127.0.0.1:8000';
                } else {
                    serverInfo.className = 'error';
                    serverInfo.innerHTML = '‚ùå –°–µ—Ä–≤–µ—Ä –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç! –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–µ—Ä –∫–æ–º–∞–Ω–¥–æ–π: uvicorn app.main_simple:app --reload';
                }
            } catch (error) {
                serverInfo.className = 'error';
                serverInfo.innerHTML = '‚ùå –°–µ—Ä–≤–µ—Ä –Ω–µ –¥–æ—Å—Ç—É–ø–µ–Ω! –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–µ—Ä –∫–æ–º–∞–Ω–¥–æ–π: uvicorn app.main_simple:app --reload';
            }

            // –ü–æ–∫–∞–∑–∞—Ç—å —Ç–æ–∫–µ–Ω –µ—Å–ª–∏ –µ—Å—Ç—å
            if (token) {
                document.getElementById('tokenInfo').style.display = 'block';
                document.getElementById('tokenValue').textContent = token.substring(0, 30) + '...';
            }
        };

        function showTab(tabName) {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
            document.querySelector(`[onclick="showTab('${tabName}')"]`).classList.add('active');
            document.getElementById(tabName).classList.add('active');
        }

        function logout() {
            localStorage.removeItem('token');
            token = '';
            document.getElementById('tokenInfo').style.display = 'none';
            showResult('–í—ã –≤—ã—à–ª–∏ –∏–∑ —Å–∏—Å—Ç–µ–º—ã');
        }

        function showResult(message) {
            document.getElementById('result').textContent = message;
        }

        async function apiCall(url, options) {
            showResult('‚è≥ –û—Ç–ø—Ä–∞–≤–∫–∞ –∑–∞–ø—Ä–æ—Å–∞...');
            try {
                const response = await fetch(url, options);
                const data = await response.json();
                showResult(JSON.stringify({
                    status: response.status,
                    statusText: response.statusText,
                    data: data
                }, null, 2));
                return { response, data };
            } catch (error) {
                showResult('‚ùå –û—à–∏–±–∫–∞: ' + error.message);
                throw error;
            }
        }

        // –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
        async function register() {
            const data = {
                email: document.getElementById('reg-email').value,
                username: document.getElementById('reg-username').value,
                full_name: document.getElementById('reg-fullname').value,
                password: document.getElementById('reg-password').value,
                role: document.getElementById('reg-role').value
            };
            
            await apiCall(`${BASE_URL}/auth/register`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(data)
            });
        }

        async function login() {
            const data = {
                username: document.getElementById('login-username').value,
                password: document.getElementById('login-password').value
            };
            
            const { response, data: result } = await apiCall(`${BASE_URL}/auth/login`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(data)
            });
            
            if (response.ok && result.access_token) {
                token = result.access_token;
                localStorage.setItem('token', token);
                document.getElementById('tokenInfo').style.display = 'block';
                document.getElementById('tokenValue').textContent = token.substring(0, 30) + '...';
            }
        }

        async function resetPasswordRequest() {
            const data = {
                email: document.getElementById('reset-email').value
            };
            
            await apiCall(`${BASE_URL}/auth/reset-password-request`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(data)
            });
        }

        async function resetPasswordConfirm() {
            const data = {
                token: document.getElementById('reset-token').value,
                new_password: document.getElementById('new-password').value
            };
            
            await apiCall(`${BASE_URL}/auth/reset-password-confirm`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(data)
            });
        }

        // –ü—Ä–æ—Ñ–∏–ª—å
        async function getUserInfo() {
            await apiCall(`${BASE_URL}/users/me?token=${token}`, {
                headers: { 'Authorization': `Bearer ${token}` }
            });
        }

        // –ö—É—Ä—Å—ã
        async function getCourses() {
            await apiCall(`${BASE_URL}/courses?token=${token}`, {
                headers: { 'Authorization': `Bearer ${token}` }
            });
        }

        async function createCourse() {
            const data = {
                name: document.getElementById('course-name').value,
                code: document.getElementById('course-code').value,
                description: document.getElementById('course-description').value,
                academic_year: document.getElementById('course-year').value,
                semester: parseInt(document.getElementById('course-semester').value)
            };
            
            await apiCall(`${BASE_URL}/courses?token=${token}`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${token}`
                },
                body: JSON.stringify(data)
            });
        }

        async function enrollCourse() {
            const courseId = document.getElementById('course-id').value;
            await apiCall(`${BASE_URL}/courses/${courseId}/enroll?token=${token}`, {
                method: 'POST',
                headers: { 'Authorization': `Bearer ${token}` }
            });
        }
    </script>
</body>
</html>