<!DOCTYPE html>
<html>
<head>
    <title>EduGrader - –°–∏—Å—Ç–µ–º–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫—É—Ä—Å–∞–º–∏</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            transition: all 0.5s ease;
        }
        
        body.locked {
            background: #000 !important;
            animation: scaryBg 0.5s infinite alternate;
        }
        
        @keyframes scaryBg {
            from { background: #000; }
            to { background: #8b0000; }
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
            transition: all 0.5s ease;
        }
        
        .container.locked {
            filter: blur(5px);
            opacity: 0.3;
            pointer-events: none;
        }
        
        .scary-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.9);
            justify-content: center;
            align-items: center;
            z-index: 9999;
            animation: scaryAppear 0.5s ease;
        }
        
        .scary-modal.active {
            display: flex;
        }
        
        @keyframes scaryAppear {
            from {
                transform: scale(0) rotate(0deg);
                opacity: 0;
            }
            to {
                transform: scale(1) rotate(360deg);
                opacity: 1;
            }
        }
        
        .scary-content {
            text-align: center;
            animation: scaryShake 0.2s infinite;
        }
        
        @keyframes scaryShake {
            0% { transform: translate(0, 0); }
            25% { transform: translate(10px, 10px); }
            50% { transform: translate(-10px, -10px); }
            75% { transform: translate(10px, -10px); }
            100% { transform: translate(-10px, 10px); }
        }
        
        .scary-image {
            max-width: 500px;
            max-height: 500px;
            border-radius: 20px;
            box-shadow: 0 0 50px red;
            animation: scaryGlow 0.5s infinite alternate;
        }
        
        @keyframes scaryGlow {
            from { box-shadow: 0 0 50px red; }
            to { box-shadow: 0 0 100px darkred; }
        }
        
        .scary-text {
            color: red;
            font-size: 48px;
            font-weight: bold;
            margin-top: 20px;
            text-shadow: 0 0 10px red;
            animation: scaryText 0.2s infinite;
        }
        
        @keyframes scaryText {
            from { opacity: 1; transform: scale(1); }
            to { opacity: 0.5; transform: scale(1.2); }
        }
        
        .attempt-counter {
            color: #ff9800;
            font-size: 14px;
            margin-top: 5px;
            text-align: center;
        }
        
        .attempt-counter.warning {
            color: #f44336;
            font-weight: bold;
            animation: pulse 1s infinite;
        }
        
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }
        
        .header {
            background: #1a237e;
            color: white;
            padding: 20px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .header h1 {
            font-size: 24px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .user-info {
            background: rgba(255,255,255,0.2);
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .role-badge {
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: bold;
            text-transform: uppercase;
        }
        
        .role-student { background: #4caf50; color: white; }
        .role-teacher { background: #ff9800; color: white; }
        .role-admin { background: #f44336; color: white; }
        
        .tabs {
            display: flex;
            background: #f5f5f5;
            border-bottom: 2px solid #e0e0e0;
            flex-wrap: wrap;
        }
        
        .tab {
            padding: 15px 25px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s;
            border-right: 1px solid #e0e0e0;
        }
        
        .tab:hover {
            background: #e0e0e0;
        }
        
        .tab.active {
            background: white;
            color: #1a237e;
            border-bottom: 3px solid #1a237e;
        }
        
        .tab-content {
            padding: 30px;
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .auth-container {
            max-width: 400px;
            margin: 0 auto;
            text-align: center;
        }
        
        .auth-container h2 {
            margin-bottom: 20px;
            color: #333;
        }
        
        .form-group {
            margin-bottom: 20px;
            text-align: left;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 5px;
            color: #666;
            font-weight: 500;
        }
        
        .form-group input, .form-group select, .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s;
        }
        
        .form-group input:focus, .form-group select:focus, .form-group textarea:focus {
            outline: none;
            border-color: #1a237e;
        }
        
        .btn {
            padding: 8px 15px;
            border: none;
            border-radius: 5px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s;
            margin: 3px;
        }
        
        .btn-primary {
            background: #1a237e;
            color: white;
        }
        
        .btn-primary:hover {
            background: #0d1757;
        }
        
        .btn-success {
            background: #4caf50;
            color: white;
        }
        
        .btn-success:hover {
            background: #388e3c;
        }
        
        .btn-danger {
            background: #f44336;
            color: white;
        }
        
        .btn-danger:hover {
            background: #d32f2f;
        }
        
        .btn-warning {
            background: #ff9800;
            color: white;
        }
        
        .btn-warning:hover {
            background: #f57c00;
        }
        
        .course-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .course-card {
            background: white;
            border: 1px solid #e0e0e0;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            transition: transform 0.3s;
        }
        
        .course-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        
        .course-card h3 {
            color: #1a237e;
            margin-bottom: 10px;
        }
        
        .course-card .code {
            color: #666;
            font-size: 14px;
            margin-bottom: 10px;
        }
        
        .course-card .teacher {
            color: #ff9800;
            font-size: 14px;
            margin-bottom: 15px;
        }
        
        .course-type-badge {
            display: inline-block;
            padding: 3px 10px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: bold;
            margin-bottom: 10px;
        }
        
        .type-regular { background: #e3f2fd; color: #0d47a1; }
        .type-test { background: #fff3e0; color: #e65100; }
        
        .assignment-item {
            background: #f5f5f5;
            padding: 15px;
            margin: 10px 0;
            border-radius: 8px;
            border-left: 4px solid #1a237e;
        }
        
        .test-question {
            background: #fff3e0;
            padding: 15px;
            margin: 10px 0;
            border-radius: 8px;
            border-left: 4px solid #ff9800;
        }
        
        .test-question h5 {
            color: #e65100;
            margin-bottom: 10px;
        }
        
        .test-option {
            margin: 8px 0;
            padding: 8px;
            background: white;
            border-radius: 5px;
            border: 1px solid #ddd;
        }
        
        .test-option.correct {
            background: #d4edda;
            border-color: #4caf50;
        }
        
        .question-number {
            font-weight: bold;
            color: #1a237e;
            margin-bottom: 5px;
        }
        
        .stats {
            display: flex;
            justify-content: space-between;
            margin: 15px 0;
            padding: 10px 0;
            border-top: 1px solid #eee;
            border-bottom: 1px solid #eee;
        }
        
        .stat-item {
            text-align: center;
        }
        
        .stat-value {
            font-size: 20px;
            font-weight: bold;
            color: #1a237e;
        }
        
        .stat-label {
            font-size: 12px;
            color: #666;
        }
        
        .grade-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        
        .grade-table th {
            background: #1a237e;
            color: white;
            padding: 12px;
            text-align: left;
        }
        
        .grade-table td {
            padding: 12px;
            border-bottom: 1px solid #e0e0e0;
        }
        
        .grade-table tr:hover {
            background: #f5f5f5;
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        
        .modal.active {
            display: flex;
        }
        
        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 10px;
            max-width: 800px;
            width: 95%;
            max-height: 90vh;
            overflow-y: auto;
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #1a237e;
        }
        
        .modal-header h2 {
            margin: 0;
            color: #1a237e;
        }
        
        .modal-close {
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            color: #666;
        }
        
        .modal-close:hover {
            color: #000;
        }
        
        .modal-footer {
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid #ddd;
            text-align: center;
        }
        
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 25px;
            border-radius: 8px;
            color: white;
            font-weight: 500;
            animation: slideIn 0.3s;
            z-index: 1001;
        }
        
        .notification.success { background: #4caf50; }
        .notification.error { background: #f44336; }
        .notification.info { background: #2196f3; }
        .notification.warning { background: #ff9800; }
        
        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
        
        .admin-panel {
            background: #f5f5f5;
            padding: 20px;
            border-radius: 8px;
            margin-top: 20px;
        }
        
        .user-list {
            margin-top: 20px;
        }
        
        .user-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            background: white;
            border-radius: 5px;
            margin-bottom: 10px;
        }
        
        .submission-box {
            background: #e8f0fe;
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
        }
        
        .submission-box textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #1a237e;
            border-radius: 5px;
            margin: 10px 0;
        }
        
        .test-result {
            background: #e8f5e9;
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
            text-align: center;
            border: 2px solid #4caf50;
        }
        
        .test-result h3 {
            color: #2e7d32;
            margin-bottom: 10px;
        }
        
        .test-score {
            font-size: 48px;
            font-weight: bold;
            color: #2e7d32;
        }
        
        @media (max-width: 768px) {
            .tabs {
                flex-direction: column;
            }
            
            .tab {
                border-right: none;
                border-bottom: 1px solid #e0e0e0;
            }
            
            .course-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- –°—Ç—Ä–∞—à–Ω–æ–µ –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ -->
    <div id="scaryModal" class="scary-modal">
        <div class="scary-content">
            <img src="https://media.giphy.com/media/3o7abB06u9bNzA8LC8/giphy.gif" alt="Scary" class="scary-image">
            <div class="scary-text">üëπ 3 –ù–ï–£–î–ê–ß–ù–´–• –ü–û–ü–´–¢–ö–ò! üëπ</div>
            <div class="scary-text" style="font-size: 24px;">–ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞ —á–µ—Ä–µ–∑ 30 —Å–µ–∫—É–Ω–¥</div>
            <div id="countdown" style="color: white; font-size: 48px; margin-top: 20px;">30</div>
            <button class="btn btn-danger" onclick="closeScaryModal()" style="margin-top: 20px; font-size: 20px; padding: 15px 30px;">–ó–∞–∫—Ä—ã—Ç—å –∫–æ—à–º–∞—Ä</button>
        </div>
    </div>

    <div class="container" id="mainContainer">
        <div class="header">
            <h1>üìö EduGrader - –°–∏—Å—Ç–µ–º–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫—É—Ä—Å–∞–º–∏</h1>
            <div id="userInfo" class="user-info" style="display: none;">
                <span id="userName"></span>
                <span id="userRole" class="role-badge"></span>
                <button class="btn btn-danger" onclick="logout()" style="padding: 5px 10px; margin: 0;">–í—ã–π—Ç–∏</button>
            </div>
        </div>

        <!-- –í–∫–ª–∞–¥–∫–∏ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ -->
        <div class="tabs" id="tabs">
            <div class="tab active" onclick="showTab('auth')" id="tabAuth">üîê –í—Ö–æ–¥/–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</div>
            <div class="tab" onclick="showTab('courses')" id="tabCourses" style="display: none;">üìö –ö—É—Ä—Å—ã</div>
            <div class="tab" onclick="showTab('myGrades')" id="tabGrades" style="display: none;">üìä –ú–æ–∏ –æ—Ü–µ–Ω–∫–∏</div>
            <div class="tab" onclick="showTab('profile')" id="tabProfile" style="display: none;">üë§ –ü—Ä–æ—Ñ–∏–ª—å</div>
            <div class="tab" onclick="showTab('admin')" id="tabAdmin" style="display: none;">‚öôÔ∏è –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ</div>
        </div>

        <!-- –í–∫–ª–∞–¥–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ -->
        <div id="auth" class="tab-content active">
            <div class="auth-container">
                <h2>üîê –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ EduGrader</h2>
                
                <div id="attemptCounter" class="attempt-counter">–û—Å—Ç–∞–ª–æ—Å—å –ø–æ–ø—ã—Ç–æ–∫: 3</div>
                
                <div class="form-group">
                    <label>–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</label>
                    <input type="text" id="authUsername" placeholder="–í–≤–µ–¥–∏—Ç–µ –∏–º—è" value="teacher">
                </div>
                
                <div class="form-group">
                    <label>–ü–∞—Ä–æ–ª—å</label>
                    <input type="password" id="authPassword" placeholder="–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å" value="123">
                </div>
                
                <div class="form-group">
                    <label>–í—ã–±–µ—Ä–∏—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ</label>
                    <select id="authAction">
                        <option value="login">–í–æ–π—Ç–∏</option>
                        <option value="register">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è</option>
                    </select>
                </div>
                
                <div class="form-group" id="roleSelect" style="display: none;">
                    <label>–†–æ–ª—å</label>
                    <select id="registerRole">
                        <option value="student">–°—Ç—É–¥–µ–Ω—Ç</option>
                        <option value="teacher">–ü—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—å</option>
                        <option value="admin">–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä</option>
                    </select>
                </div>
                
                <button class="btn btn-primary" onclick="handleAuth()" id="authButton">–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å</button>
                
                <div style="margin-top: 20px; padding: 15px; background: #f5f5f5; border-radius: 8px;">
                    <p><strong>–¢–µ—Å—Ç–æ–≤—ã–µ –∞–∫–∫–∞—É–Ω—Ç—ã:</strong></p>
                    <p>üë®‚Äçüéì –°—Ç—É–¥–µ–Ω—Ç: student / 123</p>
                    <p>üë®‚Äçüè´ –ü—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—å: teacher / 123</p>
                    <p>üë®‚Äçüíº –ê–¥–º–∏–Ω: admin / 123</p>
                </div>
            </div>
        </div>

        <!-- –í–∫–ª–∞–¥–∫–∞ –∫—É—Ä—Å–æ–≤ -->
        <div id="courses" class="tab-content">
            <h2>üìö –î–æ—Å—Ç—É–ø–Ω—ã–µ –∫—É—Ä—Å—ã</h2>
            
            <div id="teacherControls" style="display: none; margin-bottom: 20px;">
                <button class="btn btn-success" onclick="showCreateCourseModal()">‚ûï –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π –∫—É—Ä—Å</button>
            </div>
            
            <div id="adminControls" style="display: none; margin-bottom: 20px;">
                <button class="btn btn-primary" onclick="showAllCourses()">–í—Å–µ –∫—É—Ä—Å—ã</button>
                <button class="btn btn-primary" onclick="showPendingCourses()">–ù–∞ –ø—Ä–æ–≤–µ—Ä–∫–µ</button>
            </div>
            
            <div id="coursesList" class="course-grid"></div>
        </div>

        <!-- –í–∫–ª–∞–¥–∫–∞ –º–æ–∏—Ö –æ—Ü–µ–Ω–æ–∫ -->
        <div id="myGrades" class="tab-content">
            <h2>üìä –ú–æ–∏ –æ—Ü–µ–Ω–∫–∏</h2>
            <div id="gradesList"></div>
        </div>

        <!-- –í–∫–ª–∞–¥–∫–∞ –ø—Ä–æ—Ñ–∏–ª—è -->
        <div id="profile" class="tab-content">
            <h2>üë§ –ü—Ä–æ—Ñ–∏–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</h2>
            <div id="profileInfo" class="admin-panel"></div>
        </div>

        <!-- –í–∫–ª–∞–¥–∫–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ -->
        <div id="admin" class="tab-content">
            <h2>‚öôÔ∏è –ü–∞–Ω–µ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞</h2>
            
            <div class="admin-panel">
                <h3>–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å–∏—Å—Ç–µ–º—ã</h3>
                <div id="systemStats"></div>
            </div>
            
            <div class="admin-panel">
                <h3>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏</h3>
                <button class="btn btn-success" onclick="showAddUserModal()">‚ûï –î–æ–±–∞–≤–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</button>
                <div id="usersList" class="user-list"></div>
            </div>
            
            <div class="admin-panel">
                <h3>–í—Å–µ –∫—É—Ä—Å—ã</h3>
                <div id="allCoursesList"></div>
            </div>
            
            <div class="admin-panel">
                <h3>–í—Å–µ –æ—Ü–µ–Ω–∫–∏</h3>
                <div id="allGradesList"></div>
            </div>
        </div>
    </div>

    <!-- –û—Å—Ç–∞–ª—å–Ω—ã–µ –º–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞ (–±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π) -->
    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å–æ–∑–¥–∞–Ω–∏—è –∫—É—Ä—Å–∞ -->
    <div id="createCourseModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>‚ûï –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –∫—É—Ä—Å–∞</h2>
                <span class="modal-close" onclick="closeModal('createCourseModal')">&times;</span>
            </div>
            
            <div class="form-group">
                <label>–¢–∏–ø –∫—É—Ä—Å–∞</label>
                <select id="courseType">
                    <option value="regular">üìö –û–±—ã—á–Ω—ã–π –∫—É—Ä—Å (—Å –∑–∞–¥–∞–Ω–∏—è–º–∏)</option>
                    <option value="test">üìù –¢–µ—Å—Ç (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è)</option>
                </select>
            </div>
            
            <div class="form-group">
                <label>–ù–∞–∑–≤–∞–Ω–∏–µ –∫—É—Ä—Å–∞</label>
                <input type="text" id="courseName" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –ü—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ Python">
            </div>
            
            <div class="form-group">
                <label>–ö–æ–¥ –∫—É—Ä—Å–∞</label>
                <input type="text" id="courseCode" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: PYTHON101">
            </div>
            
            <div class="form-group">
                <label>–û–ø–∏—Å–∞–Ω–∏–µ</label>
                <textarea id="courseDescription" rows="4" placeholder="–û–ø–∏—à–∏—Ç–µ —Å–æ–¥–µ—Ä–∂–∞–Ω–∏–µ –∫—É—Ä—Å–∞..."></textarea>
            </div>
            
            <div id="testSettings" style="display: none;">
                <div class="form-group">
                    <label>–¢–µ–º–∞ —Ç–µ—Å—Ç–∞</label>
                    <select id="testTopic">
                        <option value="python">Python –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–µ</option>
                        <option value="math">–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞</option>
                        <option value="history">–ò—Å—Ç–æ—Ä–∏—è</option>
                        <option value="physics">–§–∏–∑–∏–∫–∞</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤–æ–ø—Ä–æ—Å–æ–≤</label>
                    <select id="questionCount">
                        <option value="5">5 –≤–æ–ø—Ä–æ—Å–æ–≤</option>
                        <option value="10" selected>10 –≤–æ–ø—Ä–æ—Å–æ–≤</option>
                        <option value="15">15 –≤–æ–ø—Ä–æ—Å–æ–≤</option>
                        <option value="20">20 –≤–æ–ø—Ä–æ—Å–æ–≤</option>
                        <option value="25">25 –≤–æ–ø—Ä–æ—Å–æ–≤</option>
                        <option value="30">30 –≤–æ–ø—Ä–æ—Å–æ–≤</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label>–°–ª–æ–∂–Ω–æ—Å—Ç—å</label>
                    <select id="difficulty">
                        <option value="easy">–õ—ë–≥–∫–∏–π</option>
                        <option value="medium" selected>–°—Ä–µ–¥–Ω–∏–π</option>
                        <option value="hard">–°–ª–æ–∂–Ω—ã–π</option>
                    </select>
                </div>
            </div>
            
            <div class="modal-footer">
                <button class="btn btn-success" onclick="createCourse()">–°–æ–∑–¥–∞—Ç—å –∫—É—Ä—Å</button>
                <button class="btn btn-danger" onclick="closeModal('createCourseModal')">–û—Ç–º–µ–Ω–∞</button>
            </div>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏—è —Ç–µ—Å—Ç–∞ -->
    <div id="takeTestModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>üìù –ü—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏–µ —Ç–µ—Å—Ç–∞</h2>
                <span class="modal-close" onclick="closeModal('takeTestModal')">&times;</span>
            </div>
            <div id="testForm"></div>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è -->
    <div id="addUserModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>‚ûï –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</h2>
                <span class="modal-close" onclick="closeModal('addUserModal')">&times;</span>
            </div>
            
            <div class="form-group">
                <label>–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</label>
                <input type="text" id="newUsername">
            </div>
            
            <div class="form-group">
                <label>–ü–∞—Ä–æ–ª—å</label>
                <input type="password" id="newPassword">
            </div>
            
            <div class="form-group">
                <label>–†–æ–ª—å</label>
                <select id="newRole">
                    <option value="student">–°—Ç—É–¥–µ–Ω—Ç</option>
                    <option value="teacher">–ü—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—å</option>
                    <option value="admin">–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä</option>
                </select>
            </div>
            
            <div class="modal-footer">
                <button class="btn btn-success" onclick="addUser()">–î–æ–±–∞–≤–∏—Ç—å</button>
                <button class="btn btn-danger" onclick="closeModal('addUserModal')">–û—Ç–º–µ–Ω–∞</button>
            </div>
        </div>
    </div>

    <script>
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
        let db = {
            users: JSON.parse(localStorage.getItem('users')) || [],
            courses: JSON.parse(localStorage.getItem('courses')) || [],
            assignments: JSON.parse(localStorage.getItem('assignments')) || [],
            submissions: JSON.parse(localStorage.getItem('submissions')) || [],
            enrollments: JSON.parse(localStorage.getItem('enrollments')) || [],
            grades: JSON.parse(localStorage.getItem('grades')) || [],
            testResults: JSON.parse(localStorage.getItem('testResults')) || [],
            currentUser: JSON.parse(localStorage.getItem('currentUser')) || null
        };

        // –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è –∑–∞—â–∏—Ç—ã –æ—Ç –±—Ä—É—Ç—Ñ–æ—Ä—Å–∞
        let failedAttempts = 0;
        let isLocked = false;
        let lockTimer = null;

        // –ë–∞–∑–∞ –∑–Ω–∞–Ω–∏–π –¥–ª—è —Ç–µ—Å—Ç–æ–≤
        const questionTemplates = {
            python: {
                easy: [
                    { question: "–ö–∞–∫–æ–π –æ–ø–µ—Ä–∞—Ç–æ—Ä –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –≤—ã–≤–æ–¥–∞ –≤ Python?", options: ["print()", "output()", "echo()", "write()"], correct: 0 },
                    { question: "–ö–∞–∫–æ–π —Ç–∏–ø –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —Ü–µ–ª—ã—Ö —á–∏—Å–µ–ª?", options: ["int", "float", "str", "bool"], correct: 0 }
                ],
                medium: [
                    { question: "–ß—Ç–æ –≤–µ—Ä–Ω–µ—Ç len([1, 2, 3])?", options: ["3", "2", "4", "–û—à–∏–±–∫—É"], correct: 0 }
                ],
                hard: [
                    { question: "–ß—Ç–æ —Ç–∞–∫–æ–µ –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä?", options: ["–§—É–Ω–∫—Ü–∏—è-–æ–±—ë—Ä—Ç–∫–∞", "–¢–∏–ø –¥–∞–Ω–Ω—ã—Ö", "–¶–∏–∫–ª", "–ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è"], correct: 0 }
                ]
            },
            math: {
                easy: [
                    { question: "2 + 2 = ?", options: ["4", "5", "6", "3"], correct: 0 }
                ],
                medium: [
                    { question: "–°–∏–Ω—É—Å 30¬∞?", options: ["0.5", "1", "0", "0.7"], correct: 0 }
                ],
                hard: [
                    { question: "lim sin(x)/x –ø—Ä–∏ x‚Üí0?", options: ["1", "0", "‚àû", "-1"], correct: 0 }
                ]
            },
            history: {
                easy: [
                    { question: "–ù–∞—á–∞–ª–æ –í—Ç–æ—Ä–æ–π –º–∏—Ä–æ–≤–æ–π?", options: ["1939", "1941", "1914", "1945"], correct: 0 }
                ],
                medium: [
                    { question: "–ì–æ–¥ –ø–æ–ª–µ—Ç–∞ –ì–∞–≥–∞—Ä–∏–Ω–∞?", options: ["1961", "1957", "1965", "1970"], correct: 0 }
                ],
                hard: [
                    { question: "–ü–µ—Ä–≤—ã–π –∫–Ω—è–∑—å –ö–∏–µ–≤—Å–∫–æ–π –†—É—Å–∏?", options: ["–†—é—Ä–∏–∫", "–û–ª–µ–≥", "–ò–≥–æ—Ä—å", "–°–≤—è—Ç–æ—Å–ª–∞–≤"], correct: 0 }
                ]
            },
            physics: {
                easy: [
                    { question: "–ï–¥–∏–Ω–∏—Ü–∞ —Å–∏–ª—ã?", options: ["–ù—å—é—Ç–æ–Ω", "–î–∂–æ—É–ª—å", "–í–∞—Ç—Ç", "–ü–∞—Å–∫–∞–ª—å"], correct: 0 }
                ],
                medium: [
                    { question: "1 –ù—å—é—Ç–æ–Ω = ?", options: ["–∫–≥¬∑–º/—Å¬≤", "–∫–≥/–º¬≤", "–∫–≥¬∑–º/—Å", "–∫–≥/—Å¬≤"], correct: 0 }
                ],
                hard: [
                    { question: "–ß—Ç–æ —Ç–∞–∫–æ–µ —ç–Ω—Ç—Ä–æ–ø–∏—è?", options: ["–ú–µ—Ä–∞ –±–µ—Å–ø–æ—Ä—è–¥–∫–∞", "–≠–Ω–µ—Ä–≥–∏—è", "–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞", "–¢–µ–ø–ª–æ"], correct: 0 }
                ]
            }
        };

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö
        function initTestData() {
            if (db.users.length === 0) {
                db.users.push(
                    { id: 1, username: 'admin', password: btoa('123'), role: 'admin', fullName: '–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä', createdAt: new Date().toISOString() },
                    { id: 2, username: 'teacher', password: btoa('123'), role: 'teacher', fullName: '–ò–≤–∞–Ω –ü–µ—Ç—Ä–æ–≤', createdAt: new Date().toISOString() },
                    { id: 3, username: 'student', password: btoa('123'), role: 'student', fullName: '–ê–Ω–Ω–∞ –°–∏–¥–æ—Ä–æ–≤–∞', createdAt: new Date().toISOString() }
                );
            }
            saveToStorage();
        }
        
        initTestData();

        function saveToStorage() {
            localStorage.setItem('users', JSON.stringify(db.users));
            localStorage.setItem('courses', JSON.stringify(db.courses));
            localStorage.setItem('assignments', JSON.stringify(db.assignments));
            localStorage.setItem('submissions', JSON.stringify(db.submissions));
            localStorage.setItem('enrollments', JSON.stringify(db.enrollments));
            localStorage.setItem('grades', JSON.stringify(db.grades));
            localStorage.setItem('testResults', JSON.stringify(db.testResults));
            localStorage.setItem('currentUser', JSON.stringify(db.currentUser));
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–∫–∞–∑–∞ —Å—Ç—Ä–∞—à–Ω–æ–≥–æ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
        function showScaryModal() {
            const modal = document.getElementById('scaryModal');
            const container = document.getElementById('mainContainer');
            const body = document.body;
            
            modal.classList.add('active');
            container.classList.add('locked');
            body.classList.add('locked');
            
            // –ë–ª–æ–∫–∏—Ä—É–µ–º –≤—Å–µ –∫–Ω–æ–ø–∫–∏
            isLocked = true;
            
            // –ó–∞–ø—É—Å–∫–∞–µ–º –æ–±—Ä–∞—Ç–Ω—ã–π –æ—Ç—Å—á–µ—Ç
            let timeLeft = 30;
            const countdownEl = document.getElementById('countdown');
            
            if (lockTimer) clearInterval(lockTimer);
            
            lockTimer = setInterval(() => {
                timeLeft--;
                countdownEl.textContent = timeLeft;
                
                if (timeLeft <= 0) {
                    clearInterval(lockTimer);
                    closeScaryModal();
                }
            }, 1000);
        }

        function closeScaryModal() {
            const modal = document.getElementById('scaryModal');
            const container = document.getElementById('mainContainer');
            const body = document.body;
            
            modal.classList.remove('active');
            container.classList.remove('locked');
            body.classList.remove('locked');
            
            // –†–∞–∑–±–ª–æ–∫–∏—Ä—É–µ–º
            isLocked = false;
            failedAttempts = 0;
            updateAttemptCounter();
            
            if (lockTimer) {
                clearInterval(lockTimer);
                lockTimer = null;
            }
        }

        function updateAttemptCounter() {
            const counterEl = document.getElementById('attemptCounter');
            const remaining = 3 - failedAttempts;
            counterEl.textContent = `–û—Å—Ç–∞–ª–æ—Å—å –ø–æ–ø—ã—Ç–æ–∫: ${remaining}`;
            
            if (failedAttempts >= 2) {
                counterEl.classList.add('warning');
            } else {
                counterEl.classList.remove('warning');
            }
        }

        // –ü–æ–∫–∞–∑–∞—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
        function showNotification(message, type = 'success') {
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.textContent = message;
            document.body.appendChild(notification);
            setTimeout(() => notification.remove(), 3000);
        }

        function showTab(tabName) {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
            event.target.classList.add('active');
            document.getElementById(tabName).classList.add('active');
        }

        function updateUI() {
            if (db.currentUser) {
                document.getElementById('tabAuth').style.display = 'none';
                document.getElementById('auth').classList.remove('active');
                document.getElementById('userInfo').style.display = 'flex';
                document.getElementById('userName').textContent = db.currentUser.fullName || db.currentUser.username;
                document.getElementById('userRole').textContent = getRoleName(db.currentUser.role);
                document.getElementById('userRole').className = `role-badge role-${db.currentUser.role}`;
                
                document.getElementById('tabCourses').style.display = 'block';
                document.getElementById('tabProfile').style.display = 'block';
                
                document.getElementById('tabGrades').style.display = db.currentUser.role === 'student' ? 'block' : 'none';
                document.getElementById('tabAdmin').style.display = db.currentUser.role === 'admin' ? 'block' : 'none';
                document.getElementById('teacherControls').style.display = (db.currentUser.role === 'teacher' || db.currentUser.role === 'admin') ? 'block' : 'none';
                
                if (db.currentUser.role === 'admin') {
                    document.getElementById('adminControls').style.display = 'block';
                    loadAdminPanel();
                } else {
                    document.getElementById('adminControls').style.display = 'none';
                }
                
                loadCourses();
                loadGrades();
                loadProfile();
                showTab('courses');
            } else {
                document.getElementById('tabAuth').style.display = 'block';
                document.getElementById('userInfo').style.display = 'none';
                document.getElementById('tabCourses').style.display = 'none';
                document.getElementById('tabGrades').style.display = 'none';
                document.getElementById('tabProfile').style.display = 'none';
                document.getElementById('tabAdmin').style.display = 'none';
                showTab('auth');
            }
        }

        function getRoleName(role) {
            return { student: '–°—Ç—É–¥–µ–Ω—Ç', teacher: '–ü—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—å', admin: '–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä' }[role] || role;
        }

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ —Å –∑–∞—â–∏—Ç–æ–π –æ—Ç –±—Ä—É—Ç—Ñ–æ—Ä—Å–∞
        function handleAuth() {
            // –ï—Å–ª–∏ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω - –Ω–∏—á–µ–≥–æ –Ω–µ –¥–µ–ª–∞–µ–º
            if (isLocked) {
                showNotification('–°–∏—Å—Ç–µ–º–∞ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–∞. –ü–æ–¥–æ–∂–¥–∏—Ç–µ 30 —Å–µ–∫—É–Ω–¥.', 'warning');
                return;
            }
            
            const username = document.getElementById('authUsername').value;
            const password = document.getElementById('authPassword').value;
            const action = document.getElementById('authAction').value;
            
            if (!username || !password) {
                showNotification('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è', 'error');
                return;
            }
            
            if (action === 'login') {
                login(username, password);
            } else {
                const role = document.getElementById('registerRole').value;
                register(username, password, role);
            }
        }

        // –í—Ö–æ–¥ —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π –ø–æ–ø—ã—Ç–æ–∫
        function login(username, password) {
            const user = db.users.find(u => u.username === username && u.password === btoa(password));
            
            if (user) {
                // –£—Å–ø–µ—à–Ω—ã–π –≤—Ö–æ–¥ - —Å–±—Ä–∞—Å—ã–≤–∞–µ–º —Å—á–µ—Ç—á–∏–∫
                failedAttempts = 0;
                updateAttemptCounter();
                db.currentUser = user;
                saveToStorage();
                showNotification(`–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, ${user.fullName || user.username}!`);
                updateUI();
            } else {
                // –ù–µ—É–¥–∞—á–Ω–∞—è –ø–æ–ø—ã—Ç–∫–∞
                failedAttempts++;
                updateAttemptCounter();
                showNotification(`–ù–µ–≤–µ—Ä–Ω–æ–µ –∏–º—è –∏–ª–∏ –ø–∞—Ä–æ–ª—å (–ø–æ–ø—ã—Ç–∫–∞ ${failedAttempts}/3)`, 'error');
                
                // –ï—Å–ª–∏ 3 –Ω–µ—É–¥–∞—á–Ω—ã—Ö –ø–æ–ø—ã—Ç–∫–∏ - –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Å—Ç—Ä–∞—à–Ω—É—é –∫–∞—Ä—Ç–∏–Ω–∫—É
                if (failedAttempts >= 3) {
                    showScaryModal();
                }
            }
        }

        // –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è
        function register(username, password, role) {
            if (db.users.find(u => u.username === username)) {
                showNotification('–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç', 'error');
                return;
            }
            
            db.users.push({
                id: Date.now(),
                username,
                password: btoa(password),
                role,
                fullName: username,
                createdAt: new Date().toISOString()
            });
            
            saveToStorage();
            showNotification('–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–∞! –¢–µ–ø–µ—Ä—å –≤–æ–π–¥–∏—Ç–µ.');
            document.getElementById('authUsername').value = '';
            document.getElementById('authPassword').value = '';
        }

        function logout() {
            db.currentUser = null;
            saveToStorage();
            showNotification('–í—ã –≤—ã—à–ª–∏ –∏–∑ —Å–∏—Å—Ç–µ–º—ã');
            updateUI();
        }

        function showCreateCourseModal() {
            document.getElementById('createCourseModal').classList.add('active');
            document.getElementById('testSettings').style.display = 'none';
        }

        function createCourse() {
            if (!db.currentUser || (db.currentUser.role !== 'teacher' && db.currentUser.role !== 'admin')) {
                showNotification('–¢–æ–ª—å–∫–æ –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª–∏ –∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—ã –º–æ–≥—É—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å –∫—É—Ä—Å—ã', 'error');
                return;
            }
            
            const type = document.getElementById('courseType').value;
            const name = document.getElementById('courseName').value;
            const code = document.getElementById('courseCode').value;
            const description = document.getElementById('courseDescription').value;
            
            if (!name || !code) {
                showNotification('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –∏ –∫–æ–¥ –∫—É—Ä—Å–∞', 'error');
                return;
            }
            
            if (db.courses.find(c => c.code === code)) {
                showNotification('–ö—É—Ä—Å —Å —Ç–∞–∫–∏–º –∫–æ–¥–æ–º —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç', 'error');
                return;
            }
            
            const newCourse = {
                id: Date.now(),
                name,
                code,
                description,
                teacherId: db.currentUser.id,
                teacherName: db.currentUser.fullName || db.currentUser.username,
                type,
                createdAt: new Date().toISOString()
            };
            
            if (type === 'test') {
                const topicInput = document.getElementById('testTopic').value;
                newCourse.topic = topicInput;
                newCourse.difficulty = document.getElementById('difficulty').value;
                newCourse.questionCount = parseInt(document.getElementById('questionCount').value);
                
                db.courses.push(newCourse);
                saveToStorage();
                generateTestQuestions(newCourse.id);
            } else {
                db.courses.push(newCourse);
                saveToStorage();
            }
            
            document.getElementById('courseName').value = '';
            document.getElementById('courseCode').value = '';
            document.getElementById('courseDescription').value = '';
            closeModal('createCourseModal');
            
            showNotification('–ö—É—Ä—Å —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω!');
            loadCourses();
        }

        function generateTestQuestions(courseId) {
            const course = db.courses.find(c => c.id === courseId);
            if (!course || course.type !== 'test') return;
            
            const topic = course.topic || 'python';
            const difficulty = course.difficulty || 'medium';
            const count = course.questionCount || 10;
            
            const templates = questionTemplates[topic] || questionTemplates.python;
            const questions = templates[difficulty] || templates.medium;
            
            const shuffled = [...questions].sort(() => 0.5 - Math.random());
            const selected = shuffled.slice(0, Math.min(count, shuffled.length));
            
            course.questions = selected.map((q, index) => ({
                id: index + 1,
                ...q
            }));
            
            saveToStorage();
        }

        function showTakeTestModal(courseId) {
            const course = db.courses.find(c => c.id === courseId);
            if (!course || !course.questions) {
                showNotification('–û—à–∏–±–∫–∞: –≤–æ–ø—Ä–æ—Å—ã —Ç–µ—Å—Ç–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã', 'error');
                return;
            }
            
            const modal = document.getElementById('takeTestModal');
            const form = document.getElementById('testForm');
            
            let html = `<h3>${course.name}</h3>`;
            html += `<p>${course.description}</p>`;
            html += `<p>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤–æ–ø—Ä–æ—Å–æ–≤: <strong>${course.questions.length}</strong></p>`;
            
            course.questions.forEach((q, index) => {
                html += `
                    <div class="test-question">
                        <div class="question-number">–í–æ–ø—Ä–æ—Å ${index + 1}:</div>
                        <h5>${q.question}</h5>
                `;
                
                q.options.forEach((option, optIndex) => {
                    html += `
                        <div class="test-option">
                            <input type="radio" name="q${q.id}" value="${optIndex}" id="q${q.id}o${optIndex}">
                            <label for="q${q.id}o${optIndex}">${option}</label>
                        </div>
                    `;
                });
                
                html += `</div>`;
            });
            
            html += `
                <div class="modal-footer">
                    <button class="btn btn-success" onclick="submitTest(${courseId})">–ó–∞–≤–µ—Ä—à–∏—Ç—å —Ç–µ—Å—Ç</button>
                    <button class="btn btn-danger" onclick="closeModal('takeTestModal')">–û—Ç–º–µ–Ω–∞</button>
                </div>
            `;
            
            form.innerHTML = html;
            modal.classList.add('active');
        }

        function submitTest(courseId) {
            const course = db.courses.find(c => c.id === courseId);
            if (!course || !course.questions) return;
            
            let correct = 0;
            const total = course.questions.length;
            
            course.questions.forEach(q => {
                const selected = document.querySelector(`input[name="q${q.id}"]:checked`);
                const answer = selected ? parseInt(selected.value) : -1;
                if (answer === q.correct) correct++;
            });
            
            const score = Math.round((correct / total) * 100);
            
            const testResult = {
                id: Date.now(),
                courseId,
                studentId: db.currentUser.id,
                studentName: db.currentUser.fullName || db.currentUser.username,
                score,
                correct,
                total,
                completedAt: new Date().toISOString()
            };
            
            db.testResults.push(testResult);
            
            db.grades.push({
                id: Date.now(),
                courseId,
                studentId: db.currentUser.id,
                score: score,
                teacherId: course.teacherId,
                date: new Date().toISOString(),
                type: 'test'
            });
            
            saveToStorage();
            
            const form = document.getElementById('testForm');
            form.innerHTML = `
                <div class="test-result">
                    <h3>–¢–µ—Å—Ç –∑–∞–≤–µ—Ä—à—ë–Ω!</h3>
                    <div class="test-score">${score}%</div>
                    <p>–ü—Ä–∞–≤–∏–ª—å–Ω—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤: ${correct} –∏–∑ ${total}</p>
                    <button class="btn btn-primary" onclick="closeModal('takeTestModal')">–ó–∞–∫—Ä—ã—Ç—å</button>
                </div>
            `;
            
            showNotification(`–¢–µ—Å—Ç –∑–∞–≤–µ—Ä—à—ë–Ω! –†–µ–∑—É–ª—å—Ç–∞—Ç: ${score}%`);
            loadCourses();
        }

        function loadCourses() {
            const coursesList = document.getElementById('coursesList');
            if (!db.currentUser) return;
            
            let courses = db.currentUser.role === 'admin' ? db.courses :
                         db.currentUser.role === 'teacher' ? db.courses.filter(c => c.teacherId === db.currentUser.id) :
                         db.courses;
            
            if (courses.length === 0) {
                coursesList.innerHTML = '<p style="text-align: center; color: #666;">–ù–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –∫—É—Ä—Å–æ–≤</p>';
                return;
            }
            
            coursesList.innerHTML = courses.map(course => {
                const enrolledCount = db.enrollments.filter(e => e.courseId === course.id).length;
                const isEnrolled = db.enrollments.some(e => e.courseId === course.id && e.studentId === db.currentUser?.id);
                const testResult = db.testResults?.find(r => r.courseId === course.id && r.studentId === db.currentUser?.id);
                
                const typeBadge = course.type === 'test' ? 
                    '<span class="course-type-badge type-test">üìù –¢–µ—Å—Ç</span>' : 
                    '<span class="course-type-badge type-regular">üìö –û–±—ã—á–Ω—ã–π –∫—É—Ä—Å</span>';
                
                return `
                    <div class="course-card">
                        <h3>${course.name}</h3>
                        ${typeBadge}
                        <div class="code">üìå –ö–æ–¥: ${course.code}</div>
                        <div class="teacher">üë®‚Äçüè´ –ü—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—å: ${course.teacherName}</div>
                        <p>${course.description || '–ù–µ—Ç –æ–ø–∏—Å–∞–Ω–∏—è'}</p>
                        <div class="stats">
                            <div class="stat-item">
                                <div class="stat-value">${enrolledCount}</div>
                                <div class="stat-label">—Å—Ç—É–¥–µ–Ω—Ç–æ–≤</div>
                            </div>
                            ${course.type === 'test' && course.questions ? `
                            <div class="stat-item">
                                <div class="stat-value">${course.questions.length}</div>
                                <div class="stat-label">–≤–æ–ø—Ä–æ—Å–æ–≤</div>
                            </div>
                            ` : ''}
                        </div>
                        
                        ${db.currentUser.role === 'student' && !isEnrolled && course.type !== 'test' ? 
                            `<button class="btn btn-success" onclick="enrollCourse(${course.id})">üìù –ó–∞–ø–∏—Å–∞—Ç—å—Å—è</button>` : ''
                        }
                        ${db.currentUser.role === 'student' && course.type === 'test' && !testResult ? 
                            `<button class="btn btn-warning" onclick="showTakeTestModal(${course.id})" style="background: #ff9800; color: white;">üìù –ü—Ä–æ–π—Ç–∏ —Ç–µ—Å—Ç (${course.questions?.length || 0} –≤–æ–ø—Ä–æ—Å–æ–≤)</button>` : ''
                        }
                        ${db.currentUser.role === 'student' && testResult ? 
                            `<div style="text-align: center; margin: 10px 0;">
                                <span style="color: #4caf50;">‚úÖ –¢–µ—Å—Ç –ø—Ä–æ–π–¥–µ–Ω</span>
                                <br><small>–†–µ–∑—É–ª—å—Ç–∞—Ç: ${testResult.score}% (${testResult.correct}/${testResult.total})</small>
                             </div>` : ''
                        }
                        ${db.currentUser.role === 'teacher' && course.teacherId === db.currentUser.id ? 
                            `<button class="btn btn-primary" onclick="showCourseStats(${course.id})">üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</button>` : ''
                        }
                        ${db.currentUser.role === 'admin' ? 
                            `<button class="btn btn-danger" onclick="deleteCourse(${course.id})">üóëÔ∏è –£–¥–∞–ª–∏—Ç—å</button>` : ''
                        }
                    </div>
                `;
            }).join('');
        }

        function enrollCourse(courseId) {
            if (!db.currentUser || db.currentUser.role !== 'student') {
                showNotification('–¢–æ–ª—å–∫–æ —Å—Ç—É–¥–µ–Ω—Ç—ã –º–æ–≥—É—Ç –∑–∞–ø–∏—Å—ã–≤–∞—Ç—å—Å—è –Ω–∞ –∫—É—Ä—Å—ã', 'error');
                return;
            }
            
            if (db.enrollments.some(e => e.courseId === courseId && e.studentId === db.currentUser.id)) {
                showNotification('–í—ã —É–∂–µ –∑–∞–ø–∏—Å–∞–Ω—ã –Ω–∞ —ç—Ç–æ—Ç –∫—É—Ä—Å', 'error');
                return;
            }
            
            db.enrollments.push({
                id: Date.now(),
                courseId,
                studentId: db.currentUser.id,
                studentName: db.currentUser.fullName || db.currentUser.username,
                enrolledAt: new Date().toISOString()
            });
            
            saveToStorage();
            showNotification('‚úÖ –í—ã —É—Å–ø–µ—à–Ω–æ –∑–∞–ø–∏—Å–∞–Ω—ã –Ω–∞ –∫—É—Ä—Å!');
            loadCourses();
        }

        function loadGrades() {
            const gradesList = document.getElementById('gradesList');
            if (!db.currentUser || db.currentUser.role !== 'student') {
                gradesList.innerHTML = '<p style="text-align: center; color: #666;">–î–æ—Å—Ç—É–ø–Ω–æ —Ç–æ–ª—å–∫–æ –¥–ª—è —Å—Ç—É–¥–µ–Ω—Ç–æ–≤</p>';
                return;
            }
            
            const grades = db.grades.filter(g => g.studentId === db.currentUser.id);
            const testResults = db.testResults?.filter(r => r.studentId === db.currentUser.id) || [];
            
            if (grades.length === 0 && testResults.length === 0) {
                gradesList.innerHTML = '<p style="text-align: center; color: #666;">–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –æ—Ü–µ–Ω–æ–∫</p>';
                return;
            }
            
            let html = '<table class="grade-table"><thead><tr><th>–ö—É—Ä—Å</th><th>–¢–∏–ø</th><th>–†–µ–∑—É–ª—å—Ç–∞—Ç</th><th>–î–∞—Ç–∞</th></tr></thead><tbody>';
            
            testResults.forEach(r => {
                const course = db.courses.find(c => c.id === r.courseId);
                html += `<tr><td>${course ? course.name : '–¢–µ—Å—Ç'}</td><td>üìù –¢–µ—Å—Ç</td><td><strong>${r.score}%</strong> (${r.correct}/${r.total})</td><td>${new Date(r.completedAt).toLocaleDateString()}</td></tr>`;
            });
            
            grades.forEach(g => {
                if (g.type !== 'test') {
                    const course = db.courses.find(c => c.id === g.courseId);
                    html += `<tr><td>${course ? course.name : '–ö—É—Ä—Å'}</td><td>üìö –ó–∞–¥–∞–Ω–∏–µ</td><td><strong>${g.score}</strong></td><td>${new Date(g.date).toLocaleDateString()}</td></tr>`;
                }
            });
            
            html += '</tbody></table>';
            gradesList.innerHTML = html;
        }

        function loadProfile() {
            if (!db.currentUser) return;
            
            const profileInfo = document.getElementById('profileInfo');
            const enrolledCount = db.enrollments.filter(e => e.studentId === db.currentUser.id).length;
            const testCount = db.testResults?.filter(r => r.studentId === db.currentUser.id).length || 0;
            const gradeCount = db.grades.filter(g => g.studentId === db.currentUser.id).length;
            
            profileInfo.innerHTML = `
                <p><strong>–ò–º—è:</strong> ${db.currentUser.fullName || db.currentUser.username}</p>
                <p><strong>–†–æ–ª—å:</strong> ${getRoleName(db.currentUser.role)}</p>
                <p><strong>–î–∞—Ç–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏:</strong> ${new Date(db.currentUser.createdAt).toLocaleDateString()}</p>
                ${db.currentUser.role === 'student' ? `
                    <p><strong>–ö—É—Ä—Å–æ–≤:</strong> ${enrolledCount}</p>
                    <p><strong>–ü—Ä–æ–π–¥–µ–Ω–æ —Ç–µ—Å—Ç–æ–≤:</strong> ${testCount}</p>
                    <p><strong>–û—Ü–µ–Ω–æ–∫:</strong> ${gradeCount}</p>
                ` : ''}
                ${db.currentUser.role === 'teacher' ? `
                    <p><strong>–°–æ–∑–¥–∞–Ω–æ –∫—É—Ä—Å–æ–≤:</strong> ${db.courses.filter(c => c.teacherId === db.currentUser.id).length}</p>
                ` : ''}
            `;
        }

        function loadAdminPanel() {
            if (!db.currentUser || db.currentUser.role !== 'admin') return;
            
            document.getElementById('systemStats').innerHTML = `
                <p>üë• –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π: ${db.users.length}</p>
                <p>üìö –ö—É—Ä—Å–æ–≤: ${db.courses.length}</p>
                <p>üìù –¢–µ—Å—Ç–æ–≤: ${db.courses.filter(c => c.type === 'test').length}</p>
                <p>üìä –û—Ü–µ–Ω–æ–∫: ${db.grades.length}</p>
            `;
            
            document.getElementById('usersList').innerHTML = db.users.map(user => `
                <div class="user-item">
                    <div><strong>${user.fullName || user.username}</strong> (${user.username}) <span class="role-badge role-${user.role}">${getRoleName(user.role)}</span></div>
                    <div><button class="btn btn-danger" onclick="deleteUser(${user.id})">üóëÔ∏è</button></div>
                </div>
            `).join('');
        }

        function showAddUserModal() {
            document.getElementById('addUserModal').classList.add('active');
        }

        function addUser() {
            const username = document.getElementById('newUsername').value;
            const password = document.getElementById('newPassword').value;
            const role = document.getElementById('newRole').value;
            
            if (!username || !password) {
                showNotification('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è', 'error');
                return;
            }
            
            if (db.users.find(u => u.username === username)) {
                showNotification('–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç', 'error');
                return;
            }
            
            db.users.push({
                id: Date.now(),
                username,
                password: btoa(password),
                role,
                fullName: username,
                createdAt: new Date().toISOString()
            });
            
            saveToStorage();
            closeModal('addUserModal');
            showNotification('–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥–æ–±–∞–≤–ª–µ–Ω');
            loadAdminPanel();
        }

        function deleteUser(userId) {
            if (userId === db.currentUser?.id) {
                showNotification('–ù–µ–ª—å–∑—è —É–¥–∞–ª–∏—Ç—å —Å–µ–±—è', 'error');
                return;
            }
            if (confirm('–£–¥–∞–ª–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è?')) {
                db.users = db.users.filter(u => u.id !== userId);
                saveToStorage();
                showNotification('–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–¥–∞–ª–µ–Ω');
                loadAdminPanel();
            }
        }

        function deleteCourse(courseId) {
            if (confirm('–£–¥–∞–ª–∏—Ç—å –∫—É—Ä—Å? –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å.')) {
                db.courses = db.courses.filter(c => c.id !== courseId);
                db.enrollments = db.enrollments.filter(e => e.courseId !== courseId);
                db.grades = db.grades.filter(g => g.courseId !== courseId);
                db.testResults = db.testResults?.filter(r => r.courseId !== courseId) || [];
                saveToStorage();
                showNotification('–ö—É—Ä—Å —É–¥–∞–ª–µ–Ω');
                loadCourses();
                if (db.currentUser?.role === 'admin') loadAdminPanel();
            }
        }

        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('active');
        }

        function showAllCourses() { loadCourses(); }
        function showPendingCourses() { showNotification('–§—É–Ω–∫—Ü–∏—è –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ'); }
        function showCourseStats(courseId) { showNotification('–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∫—É—Ä—Å–∞ –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–∞ –≤ —Å–ª–µ–¥—É—é—â–µ–π –≤–µ—Ä—Å–∏–∏'); }

        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º/—Å–∫—Ä—ã–≤–∞–µ–º –≤—ã–±–æ—Ä —Ä–æ–ª–∏ –ø—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
        document.getElementById('authAction').addEventListener('change', function(e) {
            const roleSelect = document.getElementById('roleSelect');
            roleSelect.style.display = e.target.value === 'register' ? 'block' : 'none';
        });

        // –ù–∞—á–∞–ª—å–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ
        updateUI();
        updateAttemptCounter();
    </script>
</body>
</html>