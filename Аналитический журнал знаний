# –í—Ç–æ—Ä–æ–π —Ñ–∞–π–ª - –ê–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏–π –∂—É—Ä–Ω–∞–ª –∑–Ω–∞–Ω–∏–π

```python
# database
## –ó–¥–µ—Å—å —Å–æ–¥–µ—Ä–∂–∞—Ç—Å—è –¥–∞–Ω–Ω—ã–µ –ø—Ä–æ–≥—Ä–∞–º–º—ã
import psycopg2
from psycopg2 import Error
import os
from datetime import datetime
from pathlib import Path


class Database:
    def __init__(self):
        self.connection = None
        self.cursor = None
        self.connect()

    def connect(self):
        """–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö PostgreSQL"""
        try:
            self.connection = psycopg2.connect(
                host="localhost",
                database="knowledge_journal",
                user="postgres",  # –∑–∞–º–µ–Ω–∏—Ç–µ –Ω–∞ –≤–∞—à–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                password="1111",  # –∑–∞–º–µ–Ω–∏—Ç–µ –Ω–∞ –≤–∞—à –ø–∞—Ä–æ–ª—å
                port="5432"
            )
            self.cursor = self.connection.cursor()
            print("‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ PostgreSQL —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ")
            return True
        except Error as e:
            print(f"‚ùå –û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ PostgreSQL: {e}")
            return False

    def initialize_database(self):
        """–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö (—Å–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü –µ—Å–ª–∏ –∏—Ö –Ω–µ—Ç)"""
        try:
            # –°–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã notes
            self.cursor.execute("""
                CREATE TABLE IF NOT EXISTS notes (
                    id SERIAL PRIMARY KEY,
                    title VARCHAR(255) NOT NULL,
                    file_path VARCHAR(500) UNIQUE NOT NULL,
                    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
                    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
                    category VARCHAR(100)
                )
            """)

            # –°–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã tags
            self.cursor.execute("""
                CREATE TABLE IF NOT EXISTS tags (
                    id SERIAL PRIMARY KEY,
                    name VARCHAR(100) UNIQUE NOT NULL
                )
            """)

            # –°–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã note_tags
            self.cursor.execute("""
                CREATE TABLE IF NOT EXISTS note_tags (
                    note_id INT REFERENCES notes(id) ON DELETE CASCADE,
                    tag_id INT REFERENCES tags(id) ON DELETE CASCADE,
                    PRIMARY KEY (note_id, tag_id)
                )
            """)

            # –°–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã activity_log
            self.cursor.execute("""
                CREATE TABLE IF NOT EXISTS activity_log (
                    id SERIAL PRIMARY KEY,
                    note_id INT REFERENCES notes(id) ON DELETE CASCADE,
                    event_type VARCHAR(20) CHECK (event_type IN ('CREATE', 'UPDATE', 'VIEW')),
                    event_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP
                )
            """)

            self.connection.commit()
            print("‚úÖ –¢–∞–±–ª–∏—Ü—ã –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω—ã")
            return True

        except Error as e:
            print(f"‚ùå –û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –ë–î: {e}")
            return False

    def close(self):
        """–ó–∞–∫—Ä—ã—Ç–∏–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å –ë–î"""
        if self.cursor:
            self.cursor.close()
        if self.connection:
            self.connection.close()
            print("üîå –°–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —Å –ë–î –∑–∞–∫—Ä—ã—Ç–æ")


if __name__ == "__main__":
    # –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
    db = Database()
    if db.connection:
        print("‚úÖ –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –¥–æ—Å—Ç—É–ø–Ω–∞")
        db.initialize_database()
        db.close()
    else:
        print("‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ –ë–î")

---
# –†–∞–±–æ—Ç–∞ —Å Markdown —Ñ–∞–π–ª–∞–º–∏
## file_manager
import psycopg2
from psycopg2 import Error
import os
from datetime import datetime
from pathlib import Path


class Database:
    def __init__(self):
        self.connection = None
        self.cursor = None
        self.connect()

    def connect(self):
        """–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö PostgreSQL"""
        try:
            self.connection = psycopg2.connect(
                host="localhost",
                database="knowledge_journal",
                user="postgres",  # –∑–∞–º–µ–Ω–∏—Ç–µ –Ω–∞ –≤–∞—à–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                password="1111",  # –∑–∞–º–µ–Ω–∏—Ç–µ –Ω–∞ –≤–∞—à –ø–∞—Ä–æ–ª—å
                port="5432"
            )
            self.cursor = self.connection.cursor()
            print("‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ PostgreSQL —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ")
            return True
        except Error as e:
            print(f"‚ùå –û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ PostgreSQL: {e}")
            return False

    def initialize_database(self):
        """–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö (—Å–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü –µ—Å–ª–∏ –∏—Ö –Ω–µ—Ç)"""
        try:
            # –°–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã notes
            self.cursor.execute("""
                CREATE TABLE IF NOT EXISTS notes (
                    id SERIAL PRIMARY KEY,
                    title VARCHAR(255) NOT NULL,
                    file_path VARCHAR(500) UNIQUE NOT NULL,
                    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
                    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
                    category VARCHAR(100)
                )
            """)

            # –°–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã tags
            self.cursor.execute("""
                CREATE TABLE IF NOT EXISTS tags (
                    id SERIAL PRIMARY KEY,
                    name VARCHAR(100) UNIQUE NOT NULL
                )
            """)

            # –°–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã note_tags
            self.cursor.execute("""
                CREATE TABLE IF NOT EXISTS note_tags (
                    note_id INT REFERENCES notes(id) ON DELETE CASCADE,
                    tag_id INT REFERENCES tags(id) ON DELETE CASCADE,
                    PRIMARY KEY (note_id, tag_id)
                )
            """)

            # –°–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã activity_log
            self.cursor.execute("""
                CREATE TABLE IF NOT EXISTS activity_log (
                    id SERIAL PRIMARY KEY,
                    note_id INT REFERENCES notes(id) ON DELETE CASCADE,
                    event_type VARCHAR(20) CHECK (event_type IN ('CREATE', 'UPDATE', 'VIEW')),
                    event_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP
                )
            """)

            self.connection.commit()
            print("‚úÖ –¢–∞–±–ª–∏—Ü—ã –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω—ã")
            return True

        except Error as e:
            print(f"‚ùå –û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –ë–î: {e}")
            return False

    def close(self):
        """–ó–∞–∫—Ä—ã—Ç–∏–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å –ë–î"""
        if self.cursor:
            self.cursor.close()
        if self.connection:
            self.connection.close()
            print("üîå –°–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —Å –ë–î –∑–∞–∫—Ä—ã—Ç–æ")


if __name__ == "__main__":
    # –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
    db = Database()
    if db.connection:
        print("‚úÖ –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –¥–æ—Å—Ç—É–ø–Ω–∞")
        db.initialize_database()
        db.close()
    else:
        print("‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ –ë–î")

---
# gui
## –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å Tkinter
import tkinter as tk
from tkinter import ttk, scrolledtext


class KnowledgeJournalApp:
    def __init__(self):
        self.root = tk.Tk()
        self.root.title("–ê–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏–π –∂—É—Ä–Ω–∞–ª –∑–Ω–∞–Ω–∏–π")
        self.root.geometry("1200x800")

        # 1. –ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è (Frame)
        self.create_control_panel()

        # 2. –°–ø–∏—Å–æ–∫ –∫–æ–Ω—Å–ø–µ–∫—Ç–æ–≤ (Treeview)
        self.create_notes_list()

        # 3. –û–±–ª–∞—Å—Ç—å —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è (ScrolledText)
        self.create_editor_panel()

        # 4. –ü–∞–Ω–µ–ª—å —Ç–µ–≥–æ–≤ (Frame —Å Label –∏ Entry)
        self.create_tags_panel()

        # 5. –í–∫–ª–∞–¥–∫–∞ –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ (Notebook)
        self.create_analytics_tab()

---

# analytics
## –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –∏ —Å–±–æ—Ä —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
class Analytics:
    def get_category_stats(self):
        """–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–æ–Ω—Å–ø–µ–∫—Ç–æ–≤ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º"""
        query = """
        SELECT category, COUNT(*) as count 
        FROM notes 
        GROUP BY category 
        ORDER BY count DESC
        """

    def get_recent_activity(self, days=7):
        """–ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ N –¥–Ω–µ–π"""
        query = """
        SELECT DATE(event_time) as date, 
               COUNT(*) as activities
        FROM activity_log 
        WHERE event_time >= CURRENT_DATE - INTERVAL '%s days'
        GROUP BY DATE(event_time)
        ORDER BY date
        """

    def get_top_tags(self, limit=5):
        """–°–∞–º—ã–µ –ø–æ–ø—É–ª—è—Ä–Ω—ã–µ —Ç–µ–≥–∏"""
        query = """
        SELECT t.name, COUNT(nt.note_id) as usage_count
        FROM tags t
        JOIN note_tags nt ON t.id = nt.tag_id
        GROUP BY t.id
        ORDER BY usage_count DESC
        LIMIT %s
        """

---
# excel_exporter
## –≠–∫—Å–ø–æ—Ä—Ç –≤ Excel
from openpyxl import Workbook
from openpyxl.chart import BarChart, Reference
import os


class ExcelExporter:
    def export_report(self, data, filename="exports/report.xlsx"):
        """–°–æ–∑–¥–∞–Ω–∏–µ Excel —Ñ–∞–π–ª–∞ —Å –¥–≤—É–º—è –ª–∏—Å—Ç–∞–º–∏"""

        # 1. –°–æ–∑–¥–∞—ë–º —Ä–∞–±–æ—á—É—é –∫–Ω–∏–≥—É
        wb = Workbook()

        # 2. –õ–∏—Å—Ç "–î–∞–Ω–Ω—ã–µ" - —Ç–∞–±–ª–∏—Ü–∞ —Å–æ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–æ–π
        ws_data = wb.active
        ws_data.title = "–î–∞–Ω–Ω—ã–µ"

        # 3. –î–æ–±–∞–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ
        for row in data['category_stats']:
            ws_data.append([row['category'], row['count']])

        # 4. –õ–∏—Å—Ç "–ì—Ä–∞—Ñ–∏–∫–∏" - –¥–∏–∞–≥—Ä–∞–º–º—ã
        ws_chart = wb.create_sheet("–ì—Ä–∞—Ñ–∏–∫–∏")

        # 5. –°–æ–∑–¥–∞—ë–º —Å—Ç–æ–ª–±—á–∞—Ç—É—é –¥–∏–∞–≥—Ä–∞–º–º—É
        chart = BarChart()
        chart.title = "–ö–æ–Ω—Å–ø–µ–∫—Ç—ã –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º"
        chart.x_axis.title = "–ö–∞—Ç–µ–≥–æ—Ä–∏–∏"
        chart.y_axis.title = "–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ"

        # 6. –î–æ–±–∞–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –≤ –¥–∏–∞–≥—Ä–∞–º–º—É
        data_ref = Reference(ws_data, min_col=2, min_row=1, max_row=len(data['category_stats']))
        cats_ref = Reference(ws_data, min_col=1, min_row=2, max_row=len(data['category_stats']))

        chart.add_data(data_ref, titles_from_data=True)
        chart.set_categories(cats_ref)

        # 7. –î–æ–±–∞–≤–ª—è–µ–º –¥–∏–∞–≥—Ä–∞–º–º—É –Ω–∞ –ª–∏—Å—Ç
        ws_chart.add_chart(chart, "A1")

        # 8. –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ñ–∞–π–ª
        os.makedirs("exports", exist_ok=True)
        wb.save(filename)

---
# pdf_exporter
## –ì–µ–Ω–µ—Ä–∞—Ü–∏—è PDF –æ—Ç—á—ë—Ç–æ–≤
from reportlab.lib.pagesizes import A4
from reportlab.platypus import SimpleDocTemplate, Table, TableStyle, Paragraph, Image
from reportlab.lib.styles import getSampleStyleSheet
from reportlab.lib import colors
import matplotlib.pyplot as plt


class PDFExporter:
    def export_pdf(self, data, filename="exports/report.pdf"):
        """–ì–µ–Ω–µ—Ä–∞—Ü–∏—è PDF –æ—Ç—á—ë—Ç–∞"""

        # 1. –°–æ–∑–¥–∞—ë–º PDF –¥–æ–∫—É–º–µ–Ω—Ç
        doc = SimpleDocTemplate(filename, pagesize=A4)
        story = []

        # 2. –ó–∞–≥–æ–ª–æ–≤–æ–∫
        styles = getSampleStyleSheet()
        title = Paragraph("–ê–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏–π –æ—Ç—á—ë—Ç –ø–æ –∫–æ–Ω—Å–ø–µ–∫—Ç–∞–º", styles['Title'])
        story.append(title)

        # 3. –¢–∞–±–ª–∏—Ü–∞ —Å –º–µ—Ç—Ä–∏–∫–∞–º–∏
        metrics_data = [
            ["–ú–µ—Ç—Ä–∏–∫–∞", "–ó–Ω–∞—á–µ–Ω–∏–µ"],
            ["–í—Å–µ–≥–æ –∫–æ–Ω—Å–ø–µ–∫—Ç–æ–≤", data['total_notes']],
            ["–ö–∞—Ç–µ–≥–æ—Ä–∏–π", len(data['category_stats'])],
            ["–¢–µ–≥–æ–≤", data['total_tags']],
            ["–ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –∑–∞ 7 –¥–Ω–µ–π", data['activity_7_days']]
        ]

        table = Table(metrics_data)
        table.setStyle(TableStyle([
            ('BACKGROUND', (0, 0), (-1, 0), colors.grey),
            ('TEXTCOLOR', (0, 0), (-1, 0), colors.whitesmoke),
            ('ALIGN', (0, 0), (-1, -1), 'CENTER'),
            ('GRID', (0, 0), (-1, -1), 1, colors.black)
        ]))
        story.append(table)

        # 4. –°–æ–∑–¥–∞—ë–º –≥—Ä–∞—Ñ–∏–∫ —Å matplotlib
        fig = self.create_chart(data)
        chart_path = "exports/chart_temp.png"
        fig.savefig(chart_path)

        # 5. –î–æ–±–∞–≤–ª—è–µ–º –≥—Ä–∞—Ñ–∏–∫ –≤ PDF
        chart_img = Image(chart_path, width=400, height=300)
        story.append(chart_img)

        # 6. –°–ø–∏—Å–æ–∫ –ø–æ—Å–ª–µ–¥–Ω–∏—Ö –∫–æ–Ω—Å–ø–µ–∫—Ç–æ–≤
        recent_title = Paragraph("–ü–æ—Å–ª–µ–¥–Ω–∏–µ –∫–æ–Ω—Å–ø–µ–∫—Ç—ã:", styles['Heading2'])
        story.append(recent_title)

        # 7. –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º PDF
        doc.build(story)
```
